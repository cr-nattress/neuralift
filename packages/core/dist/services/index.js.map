{"version":3,"sources":["../../src/domain/value-objects/TrainingMode.ts","../../src/services/SequenceGenerator.ts","../../src/domain/value-objects/PerformanceStats.ts","../../src/services/ScoringService.ts","../../src/services/ProfileAnalyzer.ts"],"names":[],"mappings":";;;AA4CO,SAAS,qBAAqB,IAAA,EAA6B;AAChE,EAAA,OAAO,IAAA,KAAS,qBAAqB,IAAA,KAAS,MAAA;AAChD;AAKO,SAAS,kBAAkB,IAAA,EAA6B;AAC7D,EAAA,OAAO,IAAA,KAAS,kBAAkB,IAAA,KAAS,MAAA;AAC7C;;;ACLA,SAAS,mBAAmB,IAAA,EAA4B;AACtD,EAAA,IAAI,KAAA,GAAQ,IAAA;AACZ,EAAA,OAAO,MAAM;AACX,IAAA,KAAA,GAAS,QAAQ,UAAA,GAAc,CAAA;AAC/B,IAAA,IAAI,IAAI,IAAA,CAAK,IAAA,CAAK,QAAS,KAAA,KAAU,EAAA,EAAK,IAAI,KAAK,CAAA;AACnD,IAAA,CAAA,GAAK,CAAA,GAAI,KAAK,IAAA,CAAK,CAAA,GAAK,MAAM,CAAA,EAAI,EAAA,GAAK,CAAC,CAAA,GAAK,CAAA;AAC7C,IAAA,OAAA,CAAA,CAAS,CAAA,GAAK,CAAA,KAAM,EAAA,MAAS,CAAA,IAAK,UAAA;AAAA,EACpC,CAAA;AACF;AAQO,IAAM,iBAAA,GAAN,MAAM,kBAAA,CAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAM7B,OAAwB,OAAA,GAAU,CAAC,GAAA,EAAK,GAAA,EAAK,KAAK,GAAA,EAAK,GAAA,EAAK,GAAA,EAAK,GAAA,EAAK,GAAG,CAAA;AAAA;AAAA,EAGzE,OAAwB,SAAA,GAAY,CAAA;AAAA;AAAA,EAGpC,OAAwB,yBAAA,GAA4B,GAAA;AAAA;AAAA;AAAA;AAAA,EAKpD,SAAS,MAAA,EAA0C;AACjD,IAAA,MAAM;AAAA,MACJ,KAAA;AAAA,MACA,UAAA;AAAA,MACA,IAAA;AAAA,MACA,2BAA2B,kBAAA,CAAkB,yBAAA;AAAA,MAC7C,wBAAwB,kBAAA,CAAkB,yBAAA;AAAA,MAC1C;AAAA,KACF,GAAI,MAAA;AAGJ,IAAA,MAAM,MAAA,GAAS,SAAS,MAAA,GAAY,kBAAA,CAAmB,IAAI,CAAA,GAAI,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,IAAI,CAAA;AAEpF,IAAA,MAAM,SAA2B,EAAC;AAClC,IAAA,MAAM,YAAsB,EAAC;AAC7B,IAAA,MAAM,UAAoB,EAAC;AAE3B,IAAA,MAAM,gBAAA,GAAmB,qBAAqB,IAAI,CAAA;AAClD,IAAA,MAAM,aAAA,GAAgB,kBAAkB,IAAI,CAAA;AAE5C,IAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,UAAA,EAAY,CAAA,EAAA,EAAK;AACnC,MAAA,IAAI,QAAA;AACJ,MAAA,IAAI,MAAA;AACJ,MAAA,IAAI,eAAA,GAAkB,KAAA;AACtB,MAAA,IAAI,YAAA,GAAe,KAAA;AAGnB,MAAA,MAAM,aAAa,CAAA,IAAK,KAAA;AAGxB,MAAA,MAAM,qBAAA,GACJ,UAAA,IACA,gBAAA,IACA,MAAA,EAAO,GAAI,wBAAA,IACX,CAAC,IAAA,CAAK,cAAA,CAAe,MAAA,EAAQ,UAAA,EAAY,KAAK,CAAA;AAGhD,MAAA,MAAM,kBAAA,GACJ,UAAA,IACA,aAAA,IACA,MAAA,EAAO,GAAI,qBAAA,IACX,CAAC,IAAA,CAAK,cAAA,CAAe,MAAA,EAAQ,OAAA,EAAS,KAAK,CAAA;AAG7C,MAAA,IAAI,qBAAA,IAAyB,SAAA,CAAU,MAAA,IAAU,KAAA,EAAO;AACtD,QAAA,QAAA,GAAW,SAAA,CAAU,IAAI,KAAK,CAAA;AAC9B,QAAA,eAAA,GAAkB,IAAA;AAAA,MACpB,CAAA,MAAO;AAEL,QAAA,MAAM,eAAA,GAAkB,cAAc,SAAA,CAAU,MAAA,IAAU,QAAQ,SAAA,CAAU,CAAA,GAAI,KAAK,CAAA,GAAI,EAAA;AACzF,QAAA,QAAA,GAAW,IAAA,CAAK,uBAAA,CAAwB,eAAA,EAAkB,MAAM,CAAA;AAAA,MAClE;AAGA,MAAA,IAAI,kBAAA,IAAsB,OAAA,CAAQ,MAAA,IAAU,KAAA,EAAO;AACjD,QAAA,MAAA,GAAS,OAAA,CAAQ,IAAI,KAAK,CAAA;AAC1B,QAAA,YAAA,GAAe,IAAA;AAAA,MACjB,CAAA,MAAO;AAEL,QAAA,MAAM,aAAA,GAAgB,cAAc,OAAA,CAAQ,MAAA,IAAU,QAAQ,OAAA,CAAQ,CAAA,GAAI,KAAK,CAAA,GAAI,EAAA;AACnF,QAAA,MAAA,GAAS,IAAA,CAAK,qBAAA,CAAsB,aAAA,EAAgB,MAAM,CAAA;AAAA,MAC5D;AAEA,MAAA,SAAA,CAAU,KAAK,QAAQ,CAAA;AACvB,MAAA,OAAA,CAAQ,KAAK,MAAM,CAAA;AACnB,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACV,QAAA;AAAA,QACA,WAAA,EAAa,MAAA;AAAA,QACb,eAAA;AAAA,QACA;AAAA,OACD,CAAA;AAAA,IACH;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,cAAA,CACN,MAAA,EACA,IAAA,EACA,KAAA,EACS;AACT,IAAA,IAAI,MAAA,CAAO,MAAA,KAAW,CAAA,EAAG,OAAO,KAAA;AAChC,IAAA,MAAM,SAAA,GAAY,MAAA,CAAO,MAAA,CAAO,MAAA,GAAS,CAAC,CAAA;AAC1C,IAAA,OAAO,IAAA,KAAS,UAAA,GAAa,SAAA,CAAU,eAAA,GAAkB,SAAA,CAAU,YAAA;AAAA,EACrE;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAA,CAAwB,SAAiB,MAAA,EAA8B;AAC7E,IAAA,IAAI,GAAA;AACJ,IAAA,GAAG;AACD,MAAA,GAAA,GAAM,IAAA,CAAK,KAAA,CAAM,MAAA,EAAO,GAAI,mBAAkB,SAAS,CAAA;AAAA,IACzD,SAAS,GAAA,KAAQ,OAAA;AACjB,IAAA,OAAO,GAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAA,CAAsB,SAAiB,MAAA,EAA8B;AAC3E,IAAA,IAAI,MAAA;AACJ,IAAA,GAAG;AACD,MAAA,MAAA,GAAS,kBAAA,CAAkB,QACzB,IAAA,CAAK,KAAA,CAAM,QAAO,GAAI,kBAAA,CAAkB,OAAA,CAAQ,MAAM,CACxD,CAAA;AAAA,IACF,SAAS,MAAA,KAAW,OAAA;AACpB,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,mBAAA,GAAyC;AAC9C,IAAA,OAAO,kBAAA,CAAkB,OAAA;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,WAAA,GAAsB;AAC3B,IAAA,OAAO,kBAAA,CAAkB,SAAA;AAAA,EAC3B;AACF;AAKO,SAAS,uBAAA,GAA6C;AAC3D,EAAA,OAAO,IAAI,iBAAA,EAAkB;AAC/B;;;ACzKA,SAAS,OAAO,CAAA,EAAmB;AAEjC,EAAA,MAAM,QAAA,GAAW,KAAK,GAAA,CAAI,IAAA,EAAO,KAAK,GAAA,CAAI,KAAA,EAAO,CAAC,CAAC,CAAA;AAGnD,EAAA,MAAM,EAAA,GAAK,iBAAA;AACX,EAAA,MAAM,EAAA,GAAK,gBAAA;AACX,EAAA,MAAM,EAAA,GAAK,iBAAA;AACX,EAAA,MAAM,EAAA,GAAK,gBAAA;AACX,EAAA,MAAM,EAAA,GAAK,iBAAA;AACX,EAAA,MAAM,EAAA,GAAK,aAAA;AAEX,EAAA,MAAM,EAAA,GAAK,iBAAA;AACX,EAAA,MAAM,EAAA,GAAK,gBAAA;AACX,EAAA,MAAM,EAAA,GAAK,iBAAA;AACX,EAAA,MAAM,EAAA,GAAK,gBAAA;AACX,EAAA,MAAM,EAAA,GAAK,iBAAA;AAEX,EAAA,MAAM,EAAA,GAAK,oBAAA;AACX,EAAA,MAAM,EAAA,GAAK,kBAAA;AACX,EAAA,MAAM,EAAA,GAAK,iBAAA;AACX,EAAA,MAAM,EAAA,GAAK,iBAAA;AACX,EAAA,MAAM,EAAA,GAAK,gBAAA;AACX,EAAA,MAAM,EAAA,GAAK,gBAAA;AAEX,EAAA,MAAM,EAAA,GAAK,mBAAA;AACX,EAAA,MAAM,EAAA,GAAK,gBAAA;AACX,EAAA,MAAM,EAAA,GAAK,cAAA;AACX,EAAA,MAAM,EAAA,GAAK,gBAAA;AAEX,EAAA,MAAM,IAAA,GAAO,OAAA;AACb,EAAA,MAAM,QAAQ,CAAA,GAAI,IAAA;AAElB,EAAA,IAAI,CAAA;AACJ,EAAA,IAAI,CAAA;AAEJ,EAAA,IAAI,WAAW,IAAA,EAAM;AACnB,IAAA,CAAA,GAAI,KAAK,IAAA,CAAK,EAAA,GAAK,IAAA,CAAK,GAAA,CAAI,QAAQ,CAAC,CAAA;AACrC,IAAA,OAAA,CAAA,CAAA,CAAA,CAAA,CACO,KAAK,CAAA,GAAI,EAAA,IAAM,IAAI,EAAA,IAAM,CAAA,GAAI,MAAM,CAAA,GAAI,EAAA,IAAM,CAAA,GAAI,EAAA,KAAA,CAAA,CAAA,CAClD,KAAK,CAAA,GAAI,EAAA,IAAM,IAAI,EAAA,IAAM,CAAA,GAAI,MAAM,CAAA,GAAI,CAAA,CAAA;AAAA,EAE/C,CAAA,MAAA,IAAW,YAAY,KAAA,EAAO;AAC5B,IAAA,CAAA,GAAI,QAAA,GAAW,GAAA;AACf,IAAA,CAAA,GAAI,CAAA,GAAI,CAAA;AACR,IAAA,OAAA,CAAA,CAAA,CAAA,CAAA,CACQ,EAAA,GAAK,IAAI,EAAA,IAAM,CAAA,GAAI,MAAM,CAAA,GAAI,EAAA,IAAM,IAAI,EAAA,IAAM,CAAA,GAAI,MAAM,CAAA,IAAA,CAAA,CAAA,CAAA,CACxD,EAAA,GAAK,IAAI,EAAA,IAAM,CAAA,GAAI,MAAM,CAAA,GAAI,EAAA,IAAM,CAAA,GAAI,EAAA,IAAM,CAAA,GAAI,CAAA,CAAA;AAAA,EAE1D,CAAA,MAAO;AACL,IAAA,CAAA,GAAI,KAAK,IAAA,CAAK,EAAA,GAAK,KAAK,GAAA,CAAI,CAAA,GAAI,QAAQ,CAAC,CAAA;AACzC,IAAA,OACE,MAAM,EAAA,GAAK,CAAA,GAAI,MAAM,CAAA,GAAI,EAAA,IAAM,IAAI,EAAA,IAAM,CAAA,GAAI,MAAM,CAAA,GAAI,EAAA,CAAA,IAAA,CAAA,CAAA,CACnD,KAAK,CAAA,GAAI,EAAA,IAAM,IAAI,EAAA,IAAM,CAAA,GAAI,MAAM,CAAA,GAAI,CAAA,CAAA;AAAA,EAE/C;AACF;AAKO,SAAS,uBAAuB,MAAA,EAAgD;AACrF,EAAA,MAAM,EAAE,IAAA,EAAM,MAAA,EAAQ,WAAA,EAAa,iBAAA,EAAmB,eAAc,GAAI,MAAA;AAExE,EAAA,MAAM,eAAe,IAAA,GAAO,MAAA;AAC5B,EAAA,MAAM,aAAa,WAAA,GAAc,iBAAA;AACjC,EAAA,MAAM,QAAQ,YAAA,GAAe,UAAA;AAG7B,EAAA,MAAM,OAAA,GAAU,YAAA,GAAe,CAAA,GAAI,IAAA,GAAO,YAAA,GAAe,CAAA;AACzD,EAAA,MAAM,cAAA,GAAiB,UAAA,GAAa,CAAA,GAAI,WAAA,GAAc,UAAA,GAAa,CAAA;AAGnE,EAAA,MAAM,MAAA,GAAS,MAAA,CAAO,OAAO,CAAA,GAAI,OAAO,cAAc,CAAA;AAGtD,EAAA,MAAM,mBAAmB,IAAA,GAAO,iBAAA;AAChC,EAAA,MAAM,QAAA,GAAW,KAAA,GAAQ,CAAA,GAAK,gBAAA,GAAmB,QAAS,GAAA,GAAM,CAAA;AAGhE,EAAA,MAAM,eAAA,GACJ,aAAA,CAAc,MAAA,GAAS,CAAA,GACnB,cAAc,MAAA,CAAO,CAAC,GAAA,EAAK,CAAA,KAAM,GAAA,GAAM,CAAA,EAAG,CAAC,CAAA,GAAI,cAAc,MAAA,GAC7D,IAAA;AAEN,EAAA,OAAO;AAAA,IACL,IAAA;AAAA,IACA,MAAA;AAAA,IACA,WAAA;AAAA,IACA,iBAAA;AAAA,IACA,OAAA;AAAA,IACA,cAAA;AAAA,IACA,MAAA;AAAA,IACA,QAAA;AAAA,IACA;AAAA,GACF;AACF;AAKO,SAAS,2BAAA,GAAgD;AAC9D,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,CAAA;AAAA,IACN,MAAA,EAAQ,CAAA;AAAA,IACR,WAAA,EAAa,CAAA;AAAA,IACb,iBAAA,EAAmB,CAAA;AAAA,IACnB,OAAA,EAAS,CAAA;AAAA,IACT,cAAA,EAAgB,CAAA;AAAA,IAChB,MAAA,EAAQ,CAAA;AAAA,IACR,QAAA,EAAU,CAAA;AAAA,IACV,eAAA,EAAiB;AAAA,GACnB;AACF;;;AC5GO,IAAM,iBAAN,MAAqB;AAAA;AAAA;AAAA;AAAA,EAI1B,eAAe,MAAA,EAAyC;AACtD,IAAA,IAAI,MAAA,CAAO,WAAW,CAAA,EAAG;AACvB,MAAA,OAAO,2BAAA,EAA4B;AAAA,IACrC;AAEA,IAAA,MAAM,MAAA,GAA+B;AAAA,MACnC,IAAA,EAAM,CAAA;AAAA,MACN,MAAA,EAAQ,CAAA;AAAA,MACR,WAAA,EAAa,CAAA;AAAA,MACb,iBAAA,EAAmB,CAAA;AAAA,MACnB,eAAe;AAAC,KAClB;AAEA,IAAA,KAAA,MAAW,SAAS,MAAA,EAAQ;AAC1B,MAAA,MAAM,aAAA,GAAgB,MAAM,YAAA,KAAiB,IAAA;AAE7C,MAAA,IAAI,MAAM,OAAA,EAAS;AAEjB,QAAA,IAAI,aAAA,EAAe;AACjB,UAAA,MAAA,CAAO,IAAA,EAAA;AAAA,QACT,CAAA,MAAO;AACL,UAAA,MAAA,CAAO,MAAA,EAAA;AAAA,QACT;AAAA,MACF,CAAA,MAAO;AAEL,QAAA,IAAI,aAAA,EAAe;AACjB,UAAA,MAAA,CAAO,WAAA,EAAA;AAAA,QACT,CAAA,MAAO;AACL,UAAA,MAAA,CAAO,iBAAA,EAAA;AAAA,QACT;AAAA,MACF;AAGA,MAAA,IAAI,KAAA,CAAM,iBAAiB,IAAA,EAAM;AAC/B,QAAA,MAAA,CAAO,aAAA,CAAc,IAAA,CAAK,KAAA,CAAM,YAAY,CAAA;AAAA,MAC9C;AAAA,IACF;AAEA,IAAA,OAAO,uBAAuB,MAAM,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,6BAA6B,MAAA,EAAyC;AACpE,IAAA,IAAI,MAAA,CAAO,WAAW,CAAA,EAAG;AACvB,MAAA,OAAO,2BAAA,EAA4B;AAAA,IACrC;AAEA,IAAA,IAAI,IAAA,GAAO,CAAA;AACX,IAAA,IAAI,MAAA,GAAS,CAAA;AACb,IAAA,IAAI,WAAA,GAAc,CAAA;AAClB,IAAA,IAAI,iBAAA,GAAoB,CAAA;AACxB,IAAA,MAAM,gBAA0B,EAAC;AAEjC,IAAA,KAAA,MAAW,SAAS,MAAA,EAAQ;AAC1B,MAAA,MAAM,aAAA,GAAgB,MAAM,YAAA,KAAiB,IAAA;AAE7C,MAAA,IAAI,MAAM,OAAA,EAAS;AACjB,QAAA,IAAI,aAAA,EAAe;AACjB,UAAA,IAAA,EAAA;AAAA,QACF,CAAA,MAAO;AACL,UAAA,MAAA,EAAA;AAAA,QACF;AAAA,MACF,CAAA,MAAO;AACL,QAAA,IAAI,aAAA,EAAe;AACjB,UAAA,WAAA,EAAA;AAAA,QACF,CAAA,MAAO;AACL,UAAA,iBAAA,EAAA;AAAA,QACF;AAAA,MACF;AAEA,MAAA,IAAI,KAAA,CAAM,iBAAiB,IAAA,EAAM;AAC/B,QAAA,aAAA,CAAc,IAAA,CAAK,MAAM,YAAY,CAAA;AAAA,MACvC;AAAA,IACF;AAEA,IAAA,MAAM,eAAe,IAAA,GAAO,MAAA;AAC5B,IAAA,MAAM,aAAa,WAAA,GAAc,iBAAA;AACjC,IAAA,MAAM,QAAQ,YAAA,GAAe,UAAA;AAG7B,IAAA,MAAM,UAAU,YAAA,GAAe,CAAA,GAAA,CAAK,IAAA,GAAO,GAAA,KAAQ,eAAe,CAAA,CAAA,GAAK,GAAA;AACvE,IAAA,MAAM,iBAAiB,UAAA,GAAa,CAAA,GAAA,CAAK,WAAA,GAAc,GAAA,KAAQ,aAAa,CAAA,CAAA,GAAK,GAAA;AAGjF,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,OAAA,EAAS,cAAc,CAAA;AAG3D,IAAA,MAAM,mBAAmB,IAAA,GAAO,iBAAA;AAChC,IAAA,MAAM,QAAA,GAAW,KAAA,GAAQ,CAAA,GAAK,gBAAA,GAAmB,QAAS,GAAA,GAAM,CAAA;AAGhE,IAAA,MAAM,eAAA,GACJ,aAAA,CAAc,MAAA,GAAS,CAAA,GACnB,cAAc,MAAA,CAAO,CAAC,GAAA,EAAK,CAAA,KAAM,GAAA,GAAM,CAAA,EAAG,CAAC,CAAA,GAAI,cAAc,MAAA,GAC7D,IAAA;AAEN,IAAA,OAAO;AAAA,MACL,IAAA;AAAA,MACA,MAAA;AAAA,MACA,WAAA;AAAA,MACA,iBAAA;AAAA,MACA,OAAA;AAAA,MACA,cAAA;AAAA,MACA,MAAA;AAAA,MACA,QAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,eAAA,CAAgB,SAAiB,cAAA,EAAgC;AAE/D,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,CAAI,IAAA,EAAM,KAAK,GAAA,CAAI,IAAA,EAAM,OAAO,CAAC,CAAA;AACxD,IAAA,MAAM,UAAA,GAAa,KAAK,GAAA,CAAI,IAAA,EAAM,KAAK,GAAA,CAAI,IAAA,EAAM,cAAc,CAAC,CAAA;AAEhE,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,gBAAA,CAAiB,SAAS,CAAA;AAC3C,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,gBAAA,CAAiB,UAAU,CAAA;AAE7C,IAAA,OAAO,MAAA,CAAA,CAAQ,GAAA,GAAM,IAAA,EAAM,OAAA,CAAQ,CAAC,CAAC,CAAA;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,iBAAiB,CAAA,EAAmB;AAE1C,IAAA,MAAM,CAAA,GAAI;AAAA,MACR,kBAAA;AAAA,MACA,iBAAA;AAAA,MACA,kBAAA;AAAA,MACA,gBAAA;AAAA,MACA,kBAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,MAAM,CAAA,GAAI;AAAA,MACR,kBAAA;AAAA,MACA,iBAAA;AAAA,MACA,kBAAA;AAAA,MACA,iBAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,MAAM,CAAA,GAAI;AAAA,MACR,qBAAA;AAAA,MACA,mBAAA;AAAA,MACA,kBAAA;AAAA,MACA,kBAAA;AAAA,MACA,iBAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,MAAM,CAAA,GAAI;AAAA,MACR,oBAAA;AAAA,MACA,kBAAA;AAAA,MACA,iBAAA;AAAA,MACA;AAAA,KACF;AAEA,IAAA,MAAM,IAAA,GAAO,OAAA;AACb,IAAA,MAAM,QAAQ,CAAA,GAAI,IAAA;AAElB,IAAA,IAAI,CAAA;AACJ,IAAA,IAAI,CAAA;AAEJ,IAAA,IAAI,IAAI,IAAA,EAAM;AACZ,MAAA,CAAA,GAAI,KAAK,IAAA,CAAK,EAAA,GAAK,IAAA,CAAK,GAAA,CAAI,CAAC,CAAC,CAAA;AAC9B,MAAA,OAAA,CAAA,CAAA,CAAA,CAAA,CACO,EAAE,CAAC,CAAA,GAAK,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA,IAAM,CAAA,GAAI,CAAA,CAAE,CAAC,KAAM,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA,IAAM,CAAA,GAAI,EAAE,CAAC,CAAA,IAAM,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA,KAAA,CAAA,CAAA,CACpE,CAAA,CAAE,CAAC,CAAA,GAAK,IAAI,CAAA,CAAE,CAAC,CAAA,IAAM,CAAA,GAAI,EAAE,CAAC,CAAA,IAAM,IAAI,CAAA,CAAE,CAAC,KAAM,CAAA,GAAI,CAAA,CAAA;AAAA,IAE3D,CAAA,MAAA,IAAW,KAAK,KAAA,EAAO;AACrB,MAAA,CAAA,GAAI,CAAA,GAAI,GAAA;AACR,MAAA,CAAA,GAAI,CAAA,GAAI,CAAA;AACR,MAAA,OAAA,CAAA,CAAA,CAAA,CAAA,CACQ,EAAE,CAAC,CAAA,GAAK,IAAI,CAAA,CAAE,CAAC,KAAM,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA,IAAM,CAAA,GAAI,EAAE,CAAC,CAAA,IAAM,IAAI,CAAA,CAAE,CAAC,KAAM,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA,IAAM,CAAA,IAAA,CAAA,CAAA,CAAA,CAC1E,EAAE,CAAC,CAAA,GAAK,IAAI,CAAA,CAAE,CAAC,KAAM,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA,IAAM,CAAA,GAAI,EAAE,CAAC,CAAA,IAAM,IAAI,CAAA,CAAE,CAAC,KAAM,CAAA,GAAI,CAAA,CAAA;AAAA,IAEzE,CAAA,MAAO;AACL,MAAA,CAAA,GAAI,KAAK,IAAA,CAAK,EAAA,GAAK,KAAK,GAAA,CAAI,CAAA,GAAI,CAAC,CAAC,CAAA;AAClC,MAAA,OACE,MAAM,CAAA,CAAE,CAAC,CAAA,GAAK,CAAA,GAAI,EAAE,CAAC,CAAA,IAAM,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA,IAAM,CAAA,GAAI,EAAE,CAAC,CAAA,IAAM,IAAI,CAAA,CAAE,CAAC,CAAA,IAAM,CAAA,GAAI,EAAE,CAAC,CAAA,CAAA,IAAA,CAAA,CAAA,CACrE,EAAE,CAAC,CAAA,GAAK,IAAI,CAAA,CAAE,CAAC,CAAA,IAAM,CAAA,GAAI,EAAE,CAAC,CAAA,IAAM,IAAI,CAAA,CAAE,CAAC,KAAM,CAAA,GAAI,CAAA,CAAA;AAAA,IAE3D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,sBAAA,CACE,cAAA,EACA,WAAA,EACA,IAAA,EACsB;AACtB,IAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,4BAAA,CAA6B,cAAc,CAAA;AACtE,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,4BAAA,CAA6B,WAAW,CAAA;AAEhE,IAAA,IAAI,gBAAA;AACJ,IAAA,IAAI,cAAA;AAEJ,IAAA,QAAQ,IAAA;AAAM,MACZ,KAAK,iBAAA;AACH,QAAA,gBAAA,GAAmB,aAAA,CAAc,QAAA;AACjC,QAAA,cAAA,GAAiB,aAAA,CAAc,MAAA;AAC/B,QAAA;AAAA,MACF,KAAK,cAAA;AACH,QAAA,gBAAA,GAAmB,UAAA,CAAW,QAAA;AAC9B,QAAA,cAAA,GAAiB,UAAA,CAAW,MAAA;AAC5B,QAAA;AAAA,MACF,KAAK,MAAA;AAEH,QAAA,gBAAA,GAAA,CAAoB,aAAA,CAAc,QAAA,GAAW,UAAA,CAAW,QAAA,IAAY,CAAA;AACpE,QAAA,cAAA,GAAA,CAAkB,aAAA,CAAc,MAAA,GAAS,UAAA,CAAW,MAAA,IAAU,CAAA;AAC9D,QAAA;AAAA;AAGJ,IAAA,OAAO;AAAA,MACL,aAAA;AAAA,MACA,UAAA;AAAA,MACA,gBAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,0BAAA,CACE,QACA,IAAA,EACsB;AACtB,IAAA,MAAM,iBAAiB,MAAA,CAAO,GAAA,CAAI,CAAC,CAAA,KAAM,EAAE,QAAQ,CAAA;AACnD,IAAA,MAAM,cAAc,MAAA,CAAO,GAAA,CAAI,CAAC,CAAA,KAAM,EAAE,KAAK,CAAA;AAE7C,IAAA,OAAO,IAAA,CAAK,sBAAA,CAAuB,cAAA,EAAgB,WAAA,EAAa,IAAI,CAAA;AAAA,EACtE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,oBAAoB,MAAA,EAAwD;AAC1E,IAAA,IAAI,MAAA,GAAS,GAAG,OAAO,MAAA;AACvB,IAAA,IAAI,MAAA,GAAS,GAAG,OAAO,MAAA;AACvB,IAAA,IAAI,MAAA,GAAS,GAAG,OAAO,MAAA;AACvB,IAAA,OAAO,WAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,wBAAA,CAAyB,MAAA,EAAgB,SAAA,GAAY,CAAA,EAAc;AACjE,IAAA,OAAO,MAAA,IAAU,SAAA;AAAA,EACnB;AACF;AAKO,SAAS,oBAAA,GAAuC;AACrD,EAAA,OAAO,IAAI,cAAA,EAAe;AAC5B;;;ACvOO,IAAM,kBAAN,MAAsB;AAAA;AAAA;AAAA;AAAA,EAI3B,sBAAA,CACE,QAAA,EACA,QAAA,EACA,MAAA,EACuB;AACvB,IAAA,OAAO;AAAA,MACL,WAAA,EAAa,IAAA,CAAK,kBAAA,CAAmB,QAAQ,CAAA;AAAA,MAC7C,QAAA,EAAU,IAAA,CAAK,eAAA,CAAgB,QAAA,EAAU,QAAQ,CAAA;AAAA,MACjD,UAAA,EAAY,IAAA,CAAK,iBAAA,CAAkB,QAAA,EAAU,QAAQ,CAAA;AAAA,MACrD,WAAA,EAAa,IAAA,CAAK,kBAAA,CAAmB,MAAM,CAAA;AAAA,MAC3C,QAAA,EAAU,IAAA,CAAK,gBAAA,CAAiB,QAAA,EAAU,UAAU,MAAM,CAAA;AAAA,MAC1D,kBAAA,sBAAwB,IAAA,EAAK;AAAA,MAC7B,cAAA,EAAgB,QAAA,CAAS,MAAA,GAAS,MAAA,CAAO;AAAA,KAC3C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAA,CACE,QAAA,EACA,QAAA,EACA,MAAA,EACa;AACb,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,sBAAA,CAAuB,QAAA,EAAU,UAAU,MAAM,CAAA;AACzE,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,iBAAA,CAAkB,QAAA,CAAS,YAAY,CAAA;AAE/D,IAAA,OAAO;AAAA,MACL,EAAA,EAAI,cAAA;AAAA,MACJ,YAAA,EAAc,UAAA;AAAA,MACd,eAAe,QAAA,CAAS,aAAA;AAAA,MACxB,mBAAmB,QAAA,CAAS,SAAA;AAAA,MAC5B,eAAe,QAAA,CAAS,aAAA;AAAA,MACxB,eAAe,QAAA,CAAS,aAAA;AAAA,MACxB,WAAA,EAAa;AAAA,QACX,kBAAA,EAAoB,WAAW,UAAA,CAAW,kBAAA;AAAA,QAC1C,sBAAA,EAAwB,WAAW,UAAA,CAAW,sBAAA;AAAA,QAC9C,aAAA,EAAe,IAAA;AAAA,QACf,eAAA,EAAiB,WAAW,UAAA,CAAW;AAAA,OACzC;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,YAAA,EAAc,WAAW,WAAA,CAAY,aAAA;AAAA,QACrC,aAAA,EAAe,WAAW,WAAA,CAAY,aAAA;AAAA,QACtC,UAAA,EAAY,WAAW,WAAA,CAAY,aAAA;AAAA,QACnC,gBAAA,EAAkB,SAAS,KAAA,CAAM,GAAG,EAAE,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,gBAAgB;AAAA,OACrE;AAAA,MACA,mBAAA,EAAqB;AAAA,QACnB,kBAAkB,IAAA,CAAK,yBAAA;AAAA,UACrB,WAAW,WAAA,CAAY,gBAAA;AAAA,UACvB,WAAW,WAAA,CAAY;AAAA,SACzB;AAAA,QACA,uBAAA,EAAyB,IAAA;AAAA,QACzB,oBAAA,EAAsB;AAAA,OACxB;AAAA,MACA,kBAAA,EAAoB;AAAA,QAClB,yBAAA,EAA2B,UAAA,CAAW,WAAA,CAAY,mBAAA,GAAsB,GAAA;AAAA,QACxE,sBAAA,EAAwB,UAAA,CAAW,WAAA,CAAY,mBAAA,GAAsB,GAAA;AAAA,QACrE,yBAAA,EAA2B,IAAA,CAAK,uBAAA,CAAwB,QAAQ,CAAA;AAAA,QAChE,0BAAA,EAA4B,IAAA,CAAK,iBAAA,CAAkB,QAAQ,CAAA;AAAA,QAC3D,4BAAA,EAA8B,IAAA,CAAK,qBAAA,CAAsB,QAAQ,CAAA;AAAA,QACjE,2BAAA,EAA6B,IAAA,CAAK,oBAAA,CAAqB,QAAQ;AAAA,OACjE;AAAA,MACA,WAAA,sBAAiB,IAAA;AAAK,KACxB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMQ,mBAAmB,QAAA,EAA2B;AACpD,IAAA,IAAI,QAAA,CAAS,WAAW,CAAA,EAAG;AACzB,MAAA,OAAO,KAAK,qBAAA,EAAsB;AAAA,IACpC;AAEA,IAAA,MAAM,cAAA,GAAiB,QAAA,CAAS,KAAA,CAAM,GAAG,CAAA;AACzC,IAAA,MAAM,aAAa,cAAA,CAAe,GAAA,CAAI,CAAC,CAAA,KAAM,EAAE,gBAAgB,CAAA;AAC/D,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,OAAA,CAAQ,UAAU,CAAA;AAC3C,IAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,cAAA,CAAe,UAAU,CAAA;AAEpD,IAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,oBAAA,CAAqB,cAAc,CAAA;AAC9D,IAAA,MAAM,eAAA,GAAkB,IAAA,CAAK,OAAA,CAAQ,aAAa,CAAA;AAClD,IAAA,MAAM,iBAAA,GAAoB,IAAA,CAAK,0BAAA,CAA2B,aAAa,CAAA;AAEvE,IAAA,MAAM,qBAAqB,cAAA,CAAe,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,cAAc,QAAQ,CAAA;AAC7E,IAAA,MAAM,kBAAkB,cAAA,CAAe,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,WAAW,QAAQ,CAAA;AAEvE,IAAA,OAAO;AAAA,MACL,eAAA,EAAiB,WAAA;AAAA,MACjB,aAAA;AAAA,MACA,mBAAA,EAAqB,eAAA;AAAA,MACrB,iBAAA;AAAA,MACA,gBAAA,EAAkB,IAAA,CAAK,OAAA,CAAQ,kBAAkB,CAAA,GAAI,GAAA;AAAA,MACrD,aAAA,EAAe,IAAA,CAAK,OAAA,CAAQ,eAAe,CAAA,GAAI,GAAA;AAAA,MAC/C,mBAAA,EAAqB,IAAA,CAAK,iBAAA,CAAkB,cAAc,CAAA;AAAA,MAC1D,iBAAA,EAAmB,IAAA,CAAK,aAAA,CAAc,cAAc;AAAA,KACtD;AAAA,EACF;AAAA,EAEQ,qBAAA,GAAwB;AAC9B,IAAA,OAAO;AAAA,MACL,eAAA,EAAiB,CAAA;AAAA,MACjB,aAAA,EAAe,QAAA;AAAA,MACf,mBAAA,EAAqB,CAAA;AAAA,MACrB,iBAAA,EAAmB,QAAA;AAAA,MACnB,gBAAA,EAAkB,GAAA;AAAA,MAClB,aAAA,EAAe,GAAA;AAAA,MACf,qBAAqB,EAAC;AAAA,MACtB,mBAAmB;AAAC,KACtB;AAAA,EACF;AAAA,EAEQ,qBAAqB,QAAA,EAAqC;AAChE,IAAA,MAAM,QAAkB,EAAC;AACzB,IAAA,KAAA,MAAW,WAAW,QAAA,EAAU;AAC9B,MAAA,KAAA,MAAW,KAAA,IAAS,QAAQ,MAAA,EAAQ;AAClC,QAAA,IAAI,KAAA,CAAM,yBAAyB,IAAA,EAAM;AACvC,UAAA,KAAA,CAAM,IAAA,CAAK,MAAM,oBAAoB,CAAA;AAAA,QACvC;AACA,QAAA,IAAI,KAAA,CAAM,sBAAsB,IAAA,EAAM;AACpC,UAAA,KAAA,CAAM,IAAA,CAAK,MAAM,iBAAiB,CAAA;AAAA,QACpC;AAAA,MACF;AAAA,IACF;AACA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA,EAEQ,kBAAkB,QAAA,EAA2C;AACnE,IAAA,MAAM,WAA2B,EAAC;AAClC,IAAA,IAAI,cAAA,GAAiB,CAAA;AACrB,IAAA,IAAI,WAAA,GAAc,CAAA;AAClB,IAAA,IAAI,mBAAA,GAAsB,CAAA;AAC1B,IAAA,IAAI,gBAAA,GAAmB,CAAA;AACvB,IAAA,IAAI,WAAA,GAAc,CAAA;AAElB,IAAA,KAAA,MAAW,WAAW,QAAA,EAAU;AAC9B,MAAA,KAAA,MAAW,KAAA,IAAS,QAAQ,MAAA,EAAQ;AAClC,QAAA,WAAA,EAAA;AACA,QAAA,IAAI,KAAA,CAAM,eAAA,IAAmB,KAAA,CAAM,oBAAA,KAAyB,IAAA,EAAM;AAChE,UAAA,cAAA,EAAA;AAAA,QACF;AACA,QAAA,IAAI,KAAA,CAAM,YAAA,IAAgB,KAAA,CAAM,iBAAA,KAAsB,IAAA,EAAM;AAC1D,UAAA,WAAA,EAAA;AAAA,QACF;AACA,QAAA,IAAI,CAAC,KAAA,CAAM,eAAA,IAAmB,KAAA,CAAM,yBAAyB,IAAA,EAAM;AACjE,UAAA,mBAAA,EAAA;AAAA,QACF;AACA,QAAA,IAAI,CAAC,KAAA,CAAM,YAAA,IAAgB,KAAA,CAAM,sBAAsB,IAAA,EAAM;AAC3D,UAAA,gBAAA,EAAA;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,IAAI,cAAc,CAAA,EAAG;AACnB,MAAA,MAAM,aAAA,GAAgB,IAAA;AACtB,MAAA,MAAM,WAAA,GAAc,GAAA;AAEpB,MAAA,IAAI,cAAA,GAAiB,cAAc,aAAA,EAAe;AAChD,QAAA,QAAA,CAAS,IAAA,CAAK;AAAA,UACZ,IAAA,EAAM,eAAA;AAAA,UACN,WAAW,cAAA,GAAiB,WAAA;AAAA,UAC5B,OAAA,EAAS;AAAA,SACV,CAAA;AAAA,MACH;AACA,MAAA,IAAI,WAAA,GAAc,cAAc,aAAA,EAAe;AAC7C,QAAA,QAAA,CAAS,IAAA,CAAK;AAAA,UACZ,IAAA,EAAM,YAAA;AAAA,UACN,WAAW,WAAA,GAAc,WAAA;AAAA,UACzB,OAAA,EAAS;AAAA,SACV,CAAA;AAAA,MACH;AACA,MAAA,IAAI,mBAAA,GAAsB,cAAc,WAAA,EAAa;AACnD,QAAA,QAAA,CAAS,IAAA,CAAK;AAAA,UACZ,IAAA,EAAM,sBAAA;AAAA,UACN,WAAW,mBAAA,GAAsB,WAAA;AAAA,UACjC,OAAA,EAAS;AAAA,SACV,CAAA;AAAA,MACH;AACA,MAAA,IAAI,gBAAA,GAAmB,cAAc,WAAA,EAAa;AAChD,QAAA,QAAA,CAAS,IAAA,CAAK;AAAA,UACZ,IAAA,EAAM,mBAAA;AAAA,UACN,WAAW,gBAAA,GAAmB,WAAA;AAAA,UAC9B,OAAA,EAAS;AAAA,SACV,CAAA;AAAA,MACH;AAAA,IACF;AAEA,IAAA,OAAO,QAAA;AAAA,EACT;AAAA,EAEQ,cAAc,QAAA,EAA+C;AACnE,IAAA,MAAM,aAAiC,EAAC;AAExC,IAAA,KAAA,MAAW,WAAW,QAAA,EAAU;AAC9B,MAAA,MAAM,SAAS,OAAA,CAAQ,MAAA;AACvB,MAAA,IAAI,MAAA,CAAO,SAAS,EAAA,EAAI;AAExB,MAAA,MAAM,SAAA,GAAY,OAAO,KAAA,CAAM,CAAA,EAAG,KAAK,KAAA,CAAM,MAAA,CAAO,MAAA,GAAS,CAAC,CAAC,CAAA;AAC/D,MAAA,MAAM,UAAA,GAAa,OAAO,KAAA,CAAM,IAAA,CAAK,MAAM,MAAA,CAAO,MAAA,GAAS,CAAC,CAAC,CAAA;AAE7D,MAAA,MAAM,gBAAA,GAAmB,IAAA,CAAK,sBAAA,CAAuB,SAAS,CAAA;AAC9D,MAAA,MAAM,iBAAA,GAAoB,IAAA,CAAK,sBAAA,CAAuB,UAAU,CAAA;AAEhE,MAAA,IAAI,gBAAA,GAAmB,oBAAoB,EAAA,EAAI;AAC7C,QAAA,UAAA,CAAW,IAAA,CAAK;AAAA,UACd,IAAA,EAAM,eAAA;AAAA,UACN,YAAA,EAAc,IAAA,CAAK,KAAA,CAAM,MAAA,CAAO,SAAS,CAAC,CAAA;AAAA,UAC1C,QAAA,EAAU,gBAAA,GAAmB,iBAAA,GAAoB,EAAA,GAAK,QAAA,GAAW;AAAA,SAClE,CAAA;AAAA,MACH;AAAA,IACF;AAEA,IAAA,OAAO,UAAA;AAAA,EACT;AAAA,EAEQ,uBAAuB,MAAA,EAAyC;AACtE,IAAA,IAAI,MAAA,CAAO,MAAA,KAAW,CAAA,EAAG,OAAO,CAAA;AAChC,IAAA,IAAI,OAAA,GAAU,CAAA;AACd,IAAA,IAAI,KAAA,GAAQ,CAAA;AAEZ,IAAA,KAAA,MAAW,SAAS,MAAA,EAAQ;AAC1B,MAAA,IAAI,KAAA,CAAM,oBAAA,KAAyB,IAAA,IAAQ,KAAA,CAAM,eAAA,EAAiB;AAChE,QAAA,KAAA,EAAA;AACA,QAAA,IAAI,KAAA,CAAM,oBAAA,KAAyB,KAAA,CAAM,eAAA,EAAiB;AACxD,UAAA,OAAA,EAAA;AAAA,QACF;AAAA,MACF;AACA,MAAA,IAAI,KAAA,CAAM,iBAAA,KAAsB,IAAA,IAAQ,KAAA,CAAM,YAAA,EAAc;AAC1D,QAAA,KAAA,EAAA;AACA,QAAA,IAAI,KAAA,CAAM,iBAAA,KAAsB,KAAA,CAAM,YAAA,EAAc;AAClD,UAAA,OAAA,EAAA;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,KAAA,GAAQ,CAAA,GAAK,OAAA,GAAU,KAAA,GAAS,GAAA,GAAM,CAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAMQ,eAAA,CAAgB,UAA2B,QAAA,EAAwB;AACzE,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,eAAA,CAAgB,QAAQ,CAAA;AAClD,IAAA,MAAM,eAAA,GAAkB,IAAA,CAAK,wBAAA,CAAyB,QAAA,EAAU,QAAQ,CAAA;AACxE,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,aAAA,CAAc,QAAQ,CAAA;AAE/C,IAAA,OAAO;AAAA,MACL,cAAc,QAAA,CAAS,YAAA;AAAA,MACvB,eAAA;AAAA,MACA,iBAAiB,IAAA,CAAK,GAAA,CAAI,GAAG,QAAA,CAAS,cAAA,CAAe,SAAS,CAAC,CAAA;AAAA,MAC/D,uBAAA,EAAyB,IAAA,CAAK,wBAAA,CAAyB,YAAY,CAAA;AAAA,MACnE,iBAAiB,WAAA,CAAY,QAAA;AAAA,MAC7B,iBAAiB,WAAA,CAAY,QAAA;AAAA,MAC7B,oBAAA,EAAsB,IAAA,CAAK,kBAAA,CAAmB,QAAA,EAAU,QAAQ;AAAA,KAClE;AAAA,EACF;AAAA,EAEQ,gBAAgB,QAAA,EAAgD;AACtE,IAAA,MAAM,OAAA,uBAAc,GAAA,EAAoB;AACxC,IAAA,KAAA,MAAW,WAAW,QAAA,EAAU;AAC9B,MAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,GAAA,CAAI,OAAA,CAAQ,OAAO,CAAA,IAAK,CAAA;AAC9C,MAAA,OAAA,CAAQ,GAAA,CAAI,OAAA,CAAQ,OAAA,EAAS,KAAA,GAAQ,CAAC,CAAA;AAAA,IACxC;AACA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA,EAEQ,wBAAA,CACN,UACA,QAAA,EAC4B;AAC5B,IAAA,IAAI,QAAA,CAAS,MAAA,GAAS,CAAA,EAAG,OAAO,QAAA;AAEhC,IAAA,MAAM,gBAAA,GAAmB,SAAS,MAAA,GAAS,IAAA,CAAK,IAAI,CAAA,EAAG,QAAA,CAAS,eAAe,MAAM,CAAA;AAErF,IAAA,IAAI,gBAAA,GAAmB,GAAG,OAAO,MAAA;AACjC,IAAA,IAAI,gBAAA,GAAmB,GAAG,OAAO,MAAA;AACjC,IAAA,OAAO,QAAA;AAAA,EACT;AAAA,EAEQ,yBAAyB,YAAA,EAA2C;AAC1E,IAAA,IAAI,YAAA,CAAa,IAAA,KAAS,CAAA,EAAG,OAAO,CAAA;AACpC,IAAA,MAAM,QAAA,GAAW,KAAA,CAAM,IAAA,CAAK,YAAA,CAAa,QAAQ,CAAA;AACjD,IAAA,OAAO,IAAA,CAAK,QAAQ,QAAQ,CAAA;AAAA,EAC9B;AAAA,EAEQ,cAAc,QAAA,EAA2E;AAC/F,IAAA,IAAI,QAAA,CAAS,SAAS,EAAA,EAAI,OAAO,EAAE,QAAA,EAAU,KAAA,EAAO,UAAU,IAAA,EAAK;AAEnE,IAAA,MAAM,gBAAA,GAAmB,SAAS,KAAA,CAAM,GAAG,EAAE,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,gBAAgB,CAAA;AAC1E,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,iBAAA,CAAkB,gBAAgB,CAAA;AACxD,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,OAAA,CAAQ,gBAAgB,CAAA;AAE7C,IAAA,IAAI,QAAA,GAAW,CAAA,IAAK,OAAA,GAAU,EAAA,EAAI;AAChC,MAAA,MAAM,YAAA,GAAe,QAAA,CAAS,QAAA,CAAS,MAAA,GAAS,EAAE,CAAA;AAClD,MAAA,MAAM,WAAA,GAAc,QAAA,CAAS,QAAA,CAAS,MAAA,GAAS,CAAC,CAAA;AAChD,MAAA,IAAI,gBAAgB,WAAA,EAAa;AAC/B,QAAA,MAAM,WAAW,IAAA,CAAK,KAAA;AAAA,UAAA,CACnB,WAAA,CAAY,SAAA,CAAU,OAAA,EAAQ,GAAI,YAAA,CAAa,UAAU,OAAA,EAAQ,KAC/D,EAAA,GAAK,EAAA,GAAK,EAAA,GAAK,GAAA;AAAA,SACpB;AACA,QAAA,OAAO,EAAE,QAAA,EAAU,IAAA,EAAM,QAAA,EAAS;AAAA,MACpC;AAAA,IACF;AAEA,IAAA,OAAO,EAAE,QAAA,EAAU,KAAA,EAAO,QAAA,EAAU,IAAA,EAAK;AAAA,EAC3C;AAAA,EAEQ,kBAAA,CAAmB,UAA2B,QAAA,EAAuC;AAC3F,IAAA,IAAI,QAAA,CAAS,MAAA,KAAW,CAAA,EAAG,OAAO,IAAA;AAElC,IAAA,MAAM,cAAA,GAAiB,QAAA,CAAS,KAAA,CAAM,EAAE,CAAA;AACxC,IAAA,MAAM,WAAA,GAAc,KAAK,OAAA,CAAQ,cAAA,CAAe,IAAI,CAAC,CAAA,KAAM,CAAA,CAAE,gBAAgB,CAAC,CAAA;AAE9E,IAAA,IAAI,eAAe,EAAA,EAAI;AACrB,MAAA,MAAM,eAAe,QAAA,CAAS,YAAA;AAC9B,MAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,iBAAA,CAAkB,YAAY,CAAA;AAEjD,MAAA,IAAI,YAAA,CAAa,QAAA,CAAS,UAAU,CAAA,EAAG;AACrC,QAAA,OAAO,CAAA,SAAA,EAAY,QAAQ,CAAC,CAAA,CAAA;AAAA,MAC9B,CAAA,MAAA,IAAW,YAAA,CAAa,QAAA,CAAS,OAAO,CAAA,EAAG;AACzC,QAAA,OAAO,CAAA,MAAA,EAAS,QAAQ,CAAC,CAAA,CAAA;AAAA,MAC3B,CAAA,MAAA,IAAW,YAAA,CAAa,QAAA,CAAS,MAAM,CAAA,EAAG;AACxC,QAAA,OAAO,CAAA,KAAA,EAAQ,QAAQ,CAAC,CAAA,CAAA;AAAA,MAC1B;AAAA,IACF;AAEA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMQ,iBAAA,CAAkB,UAA2B,QAAA,EAAwB;AAC3E,IAAA,MAAM,GAAA,uBAAU,IAAA,EAAK;AACrB,IAAA,MAAM,OAAA,GAAU,IAAI,IAAA,CAAK,GAAA,CAAI,OAAA,KAAY,CAAA,GAAI,EAAA,GAAK,EAAA,GAAK,EAAA,GAAK,GAAI,CAAA;AAChE,IAAA,MAAM,gBAAA,GAAmB,SAAS,MAAA,CAAO,CAAC,MAAM,CAAA,CAAE,SAAA,GAAY,OAAO,CAAA,CAAE,MAAA;AAEvE,IAAA,MAAM,mBAAmB,QAAA,CAAS,GAAA,CAAI,CAAC,CAAA,KAAM,EAAE,QAAQ,CAAA;AACvD,IAAA,MAAM,YAAA,GAAe,SAAS,GAAA,CAAI,CAAC,MAAM,CAAA,CAAE,SAAA,CAAU,UAAU,CAAA;AAE/D,IAAA,OAAO;AAAA,MACL,eAAe,QAAA,CAAS,MAAA;AAAA,MACxB,gBAAA;AAAA,MACA,sBAAA,EAAwB,IAAA,CAAK,sBAAA,CAAuB,QAAQ,CAAA;AAAA,MAC5D,kBAAA,EAAoB,IAAA,CAAK,mBAAA,CAAoB,YAAY,CAAA;AAAA,MACzD,sBAAA,EAAwB,IAAA,CAAK,OAAA,CAAQ,gBAAgB,CAAA;AAAA,MACrD,eAAe,QAAA,CAAS,aAAA;AAAA,MACxB,eAAe,QAAA,CAAS,aAAA;AAAA,MACxB,iBAAiB,QAAA,CAAS,eAAA;AAAA,MAC1B,sBAAsB,QAAA,CAAS,eAAA,GAC3B,IAAA,CAAK,KAAA,CAAA,CAAO,IAAI,OAAA,EAAQ,GAAI,QAAA,CAAS,eAAA,CAAgB,SAAQ,KAAM,EAAA,GAAK,EAAA,GAAK,EAAA,GAAK,IAAK,CAAA,GACvF;AAAA,KACN;AAAA,EACF;AAAA,EAEQ,uBAAuB,QAAA,EAAmC;AAChE,IAAA,IAAI,QAAA,CAAS,MAAA,KAAW,CAAA,EAAG,OAAO,CAAA;AAElC,IAAA,MAAM,YAAA,GAAe,SAAS,CAAC,CAAA;AAC/B,IAAA,MAAM,WAAA,GAAc,QAAA,CAAS,QAAA,CAAS,MAAA,GAAS,CAAC,CAAA;AAEhD,IAAA,IAAI,CAAC,YAAA,IAAgB,CAAC,WAAA,EAAa,OAAO,CAAA;AAE1C,IAAA,MAAM,QAAQ,IAAA,CAAK,GAAA;AAAA,MACjB,CAAA;AAAA,MAAA,CACC,WAAA,CAAY,SAAA,CAAU,OAAA,EAAQ,GAAI,YAAA,CAAa,SAAA,CAAU,OAAA,EAAQ,KAC/D,CAAA,GAAI,EAAA,GAAK,EAAA,GAAK,EAAA,GAAK,GAAA;AAAA,KACxB;AAEA,IAAA,OAAO,SAAS,MAAA,GAAS,KAAA;AAAA,EAC3B;AAAA,EAEQ,oBAAoB,KAAA,EAAuE;AACjG,IAAA,IAAI,KAAA,CAAM,MAAA,KAAW,CAAA,EAAG,OAAO,IAAA;AAE/B,IAAA,MAAM,OAAA,GAAU,EAAE,OAAA,EAAS,CAAA,EAAG,WAAW,CAAA,EAAG,OAAA,EAAS,CAAA,EAAG,KAAA,EAAO,CAAA,EAAE;AAEjE,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAI,IAAA,IAAQ,CAAA,IAAK,IAAA,GAAO,EAAA,EAAI,OAAA,CAAQ,OAAA,EAAA;AAAA,WAAA,IAC3B,IAAA,IAAQ,EAAA,IAAM,IAAA,GAAO,EAAA,EAAI,OAAA,CAAQ,SAAA,EAAA;AAAA,WAAA,IACjC,IAAA,IAAQ,EAAA,IAAM,IAAA,GAAO,EAAA,EAAI,OAAA,CAAQ,OAAA,EAAA;AAAA,WACrC,OAAA,CAAQ,KAAA,EAAA;AAAA,IACf;AAEA,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,GAAA,CAAI,OAAA,CAAQ,OAAA,EAAS,QAAQ,SAAA,EAAW,OAAA,CAAQ,OAAA,EAAS,OAAA,CAAQ,KAAK,CAAA;AAEvF,IAAA,IAAI,GAAA,KAAQ,OAAA,CAAQ,OAAA,EAAS,OAAO,SAAA;AACpC,IAAA,IAAI,GAAA,KAAQ,OAAA,CAAQ,SAAA,EAAW,OAAO,WAAA;AACtC,IAAA,IAAI,GAAA,KAAQ,OAAA,CAAQ,OAAA,EAAS,OAAO,SAAA;AACpC,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMQ,mBAAmB,MAAA,EAA0B;AACnD,IAAA,MAAM,aAAa,MAAA,CAAO,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,aAAa,MAAM,CAAA;AAC7D,IAAA,MAAM,gBAAgB,UAAA,CAAW,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,SAAS,aAAa,CAAA;AAEvE,IAAA,OAAO;AAAA,MACL,kBAAkB,aAAA,CAAc,MAAA;AAAA,MAChC,wBAAwB,IAAA,CAAK,OAAA;AAAA,QAC3B,aAAA,CAAc,GAAA,CAAI,CAAC,CAAA,KAAM;AACvB,UAAA,MAAM,UAAU,CAAA,CAAE,OAAA;AAClB,UAAA,OAAO,OAAO,OAAA,CAAQ,QAAA,KAAa,QAAA,GAAW,QAAQ,QAAA,GAAW,CAAA;AAAA,QACnE,CAAC;AAAA,OACH;AAAA,MACA,eAAe,UAAA,CAAW,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,SAAS,gBAAgB,CAAA;AAAA,MACjE,oBAAA,EAAsB,IAAA,CAAK,gBAAA,CAAiB,aAAa,CAAA;AAAA,MACzD,aAAA,EAAe,IAAA,CAAK,kBAAA,CAAmB,aAAa;AAAA,KACtD;AAAA,EACF;AAAA,EAEQ,iBAAiB,MAAA,EAAoC;AAC3D,IAAA,MAAM,OAAA,uBAAc,GAAA,EAAoB;AAExC,IAAA,KAAA,MAAW,SAAS,MAAA,EAAQ;AAC1B,MAAA,MAAM,UAAU,KAAA,CAAM,OAAA;AACtB,MAAA,MAAM,SAAS,OAAO,OAAA,CAAQ,MAAA,KAAW,QAAA,GAAW,QAAQ,MAAA,GAAS,EAAA;AACrE,MAAA,IAAI,MAAA,EAAQ;AACV,QAAA,OAAA,CAAQ,IAAI,MAAA,EAAA,CAAS,OAAA,CAAQ,IAAI,MAAM,CAAA,IAAK,KAAK,CAAC,CAAA;AAAA,MACpD;AAAA,IACF;AAEA,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,OAAA,CAAQ,OAAA,EAAS,CAAA,CAChC,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAM,CAAA,CAAE,CAAC,CAAA,GAAI,EAAE,CAAC,CAAC,CAAA,CAC1B,KAAA,CAAM,CAAA,EAAG,CAAC,CAAA,CACV,GAAA,CAAI,CAAC,CAAC,EAAE,CAAA,KAAM,EAAE,CAAA;AAAA,EACrB;AAAA,EAEQ,mBAAmB,MAAA,EAAkE;AAC3F,IAAA,IAAI,MAAA,CAAO,MAAA,GAAS,CAAA,EAAG,OAAO,QAAA;AAE9B,IAAA,MAAM,MAAA,GAAS,CAAC,GAAG,MAAM,CAAA,CAAE,IAAA;AAAA,MACzB,CAAC,GAAG,CAAA,KAAM,CAAA,CAAE,UAAU,OAAA,EAAQ,GAAI,CAAA,CAAE,SAAA,CAAU,OAAA;AAAQ,KACxD;AAEA,IAAA,MAAM,SAAA,GAAY,OAAO,KAAA,CAAM,CAAA,EAAG,KAAK,KAAA,CAAM,MAAA,CAAO,MAAA,GAAS,CAAC,CAAC,CAAA;AAC/D,IAAA,MAAM,UAAA,GAAa,OAAO,KAAA,CAAM,IAAA,CAAK,MAAM,MAAA,CAAO,MAAA,GAAS,CAAC,CAAC,CAAA;AAE7D,IAAA,IAAI,UAAA,CAAW,MAAA,GAAS,SAAA,CAAU,MAAA,GAAS,KAAK,OAAO,YAAA;AACvD,IAAA,IAAI,UAAA,CAAW,MAAA,GAAS,SAAA,CAAU,MAAA,GAAS,KAAK,OAAO,YAAA;AACvD,IAAA,OAAO,QAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMQ,gBAAA,CACN,QAAA,EACA,QAAA,EACA,MAAA,EACA;AACA,IAAA,MAAM,YAAsB,EAAC;AAC7B,IAAA,MAAM,eAAyB,EAAC;AAChC,IAAA,MAAM,eAAyB,EAAC;AAChC,IAAA,MAAM,gBAA0B,EAAC;AAEjC,IAAA,IAAI,QAAA,CAAS,SAAS,CAAA,EAAG;AACvB,MAAA,MAAM,cAAA,GAAiB,QAAA,CAAS,KAAA,CAAM,GAAG,CAAA;AACzC,MAAA,MAAM,WAAA,GAAc,KAAK,OAAA,CAAQ,cAAA,CAAe,IAAI,CAAC,CAAA,KAAM,CAAA,CAAE,gBAAgB,CAAC,CAAA;AAC9E,MAAA,MAAM,WAAA,GAAc,IAAA,CAAK,OAAA,CAAQ,cAAA,CAAe,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,aAAA,CAAc,QAAQ,CAAC,CAAA;AACpF,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,OAAA,CAAQ,cAAA,CAAe,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,UAAA,CAAW,QAAQ,CAAC,CAAA;AAE9E,MAAA,IAAI,eAAe,EAAA,EAAI;AACrB,QAAA,SAAA,CAAU,KAAK,4BAA4B,CAAA;AAAA,MAC7C;AACA,MAAA,IAAI,WAAA,GAAc,WAAW,EAAA,EAAI;AAC/B,QAAA,SAAA,CAAU,KAAK,+BAA+B,CAAA;AAC9C,QAAA,YAAA,CAAa,KAAK,6CAA6C,CAAA;AAAA,MACjE,CAAA,MAAA,IAAW,QAAA,GAAW,WAAA,GAAc,EAAA,EAAI;AACtC,QAAA,SAAA,CAAU,KAAK,gCAAgC,CAAA;AAC/C,QAAA,YAAA,CAAa,KAAK,gDAAgD,CAAA;AAAA,MACpE;AAEA,MAAA,IAAI,QAAA,CAAS,iBAAiB,CAAA,EAAG;AAC/B,QAAA,YAAA,CAAa,KAAK,oDAAoD,CAAA;AAAA,MACxE;AAEA,MAAA,IAAI,cAAc,EAAA,EAAI;AACpB,QAAA,YAAA,CAAa,KAAK,6CAA6C,CAAA;AAC/D,QAAA,aAAA,CAAc,KAAK,4BAA4B,CAAA;AAAA,MACjD;AAAA,IACF;AAEA,IAAA,IAAI,QAAA,CAAS,aAAA,KAAkB,CAAA,IAAK,QAAA,CAAS,gBAAgB,CAAA,EAAG;AAC9D,MAAA,aAAA,CAAc,KAAK,kCAAkC,CAAA;AAAA,IACvD;AAEA,IAAA,OAAO;AAAA,MACL,SAAA;AAAA,MACA,mBAAA,EAAqB,YAAA;AAAA,MACrB,mBAAA,EAAqB,YAAA;AAAA,MACrB,WAAA,EAAa,IAAA,CAAK,eAAA,CAAgB,QAAA,EAAU,QAAQ,CAAA;AAAA,MACpD,sBAAA,EAAwB;AAAA,KAC1B;AAAA,EACF;AAAA,EAEQ,eAAA,CACN,UACA,QAAA,EAC2B;AAC3B,IAAA,IAAI,QAAA,CAAS,eAAA,KAAoB,IAAA,EAAM,OAAO,MAAA;AAE9C,IAAA,MAAM,uBAAuB,IAAA,CAAK,KAAA;AAAA,MAAA,CAC/B,IAAA,CAAK,KAAI,GAAI,QAAA,CAAS,gBAAgB,OAAA,EAAQ,KAAM,EAAA,GAAK,EAAA,GAAK,EAAA,GAAK,GAAA;AAAA,KACtE;AAEA,IAAA,IAAI,oBAAA,GAAuB,IAAI,OAAO,MAAA;AACtC,IAAA,IAAI,oBAAA,GAAuB,GAAG,OAAO,QAAA;AAErC,IAAA,MAAM,cAAA,GAAiB,QAAA,CAAS,KAAA,CAAM,EAAE,CAAA;AACxC,IAAA,IAAI,cAAA,CAAe,SAAS,CAAA,EAAG;AAC7B,MAAA,MAAM,WAAA,GAAc,KAAK,OAAA,CAAQ,cAAA,CAAe,IAAI,CAAC,CAAA,KAAM,CAAA,CAAE,gBAAgB,CAAC,CAAA;AAC9E,MAAA,IAAI,WAAA,GAAc,IAAI,OAAO,QAAA;AAAA,IAC/B;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMQ,QAAQ,IAAA,EAAwB;AACtC,IAAA,IAAI,IAAA,CAAK,MAAA,KAAW,CAAA,EAAG,OAAO,CAAA;AAC9B,IAAA,OAAO,IAAA,CAAK,OAAO,CAAC,CAAA,EAAG,MAAM,CAAA,GAAI,CAAA,EAAG,CAAC,CAAA,GAAI,IAAA,CAAK,MAAA;AAAA,EAChD;AAAA,EAEQ,kBAAkB,IAAA,EAAwB;AAChD,IAAA,IAAI,IAAA,CAAK,MAAA,KAAW,CAAA,EAAG,OAAO,CAAA;AAC9B,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,CAAA;AAC7B,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,GAAA,CAAI,CAAC,CAAA,KAAM,KAAK,GAAA,CAAI,CAAA,GAAI,GAAA,EAAK,CAAC,CAAC,CAAA;AACzD,IAAA,OAAO,IAAA,CAAK,QAAQ,YAAY,CAAA;AAAA,EAClC;AAAA,EAEQ,eAAe,MAAA,EAAwD;AAC7E,IAAA,IAAI,MAAA,CAAO,MAAA,GAAS,CAAA,EAAG,OAAO,QAAA;AAE9B,IAAA,MAAM,SAAA,GAAY,OAAO,KAAA,CAAM,CAAA,EAAG,KAAK,KAAA,CAAM,MAAA,CAAO,MAAA,GAAS,CAAC,CAAC,CAAA;AAC/D,IAAA,MAAM,UAAA,GAAa,OAAO,KAAA,CAAM,IAAA,CAAK,MAAM,MAAA,CAAO,MAAA,GAAS,CAAC,CAAC,CAAA;AAE7D,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,OAAA,CAAQ,SAAS,CAAA;AACvC,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,OAAA,CAAQ,UAAU,CAAA;AAEzC,IAAA,MAAM,OAAO,SAAA,GAAY,QAAA;AAEzB,IAAA,IAAI,IAAA,GAAO,GAAG,OAAO,WAAA;AACrB,IAAA,IAAI,IAAA,GAAO,IAAI,OAAO,WAAA;AACtB,IAAA,OAAO,QAAA;AAAA,EACT;AAAA,EAEQ,2BAA2B,MAAA,EAAkD;AACnF,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,cAAA,CAAe,MAAM,CAAA;AACxC,IAAA,IAAI,KAAA,KAAU,aAAa,OAAO,QAAA;AAClC,IAAA,IAAI,KAAA,KAAU,aAAa,OAAO,QAAA;AAClC,IAAA,OAAO,QAAA;AAAA,EACT;AAAA,EAEQ,kBAAkB,OAAA,EAAoD;AAC5E,IAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,KAAA,CAAM,OAAO,CAAA;AACnC,IAAA,IAAI,KAAA,IAAS,KAAA,CAAM,CAAC,CAAA,EAAG;AACrB,MAAA,MAAM,GAAA,GAAM,QAAA,CAAS,KAAA,CAAM,CAAC,GAAG,EAAE,CAAA;AACjC,MAAA,IAAI,GAAA,IAAO,CAAA,IAAK,GAAA,IAAO,CAAA,EAAG,OAAO,GAAA;AAAA,IACnC;AACA,IAAA,OAAO,CAAA;AAAA,EACT;AAAA,EAEQ,yBAAA,CACN,kBACA,aAAA,EACmC;AACnC,IAAA,MAAM,OAAO,gBAAA,GAAmB,aAAA;AAChC,IAAA,IAAI,IAAA,GAAO,KAAK,OAAO,UAAA;AACvB,IAAA,IAAI,IAAA,GAAO,MAAM,OAAO,OAAA;AACxB,IAAA,OAAO,UAAA;AAAA,EACT;AAAA,EAEQ,wBAAwB,QAAA,EAAoC;AAClE,IAAA,IAAI,QAAA,CAAS,MAAA,KAAW,CAAA,EAAG,OAAO,KAAA;AAClC,IAAA,MAAM,cAAA,GAAiB,QAAA,CAAS,KAAA,CAAM,EAAE,CAAA;AACxC,IAAA,MAAM,oBAAoB,IAAA,CAAK,OAAA;AAAA,MAC7B,cAAA,CAAe,GAAA;AAAA,QACb,CAAC,CAAA,KAAA,CAAO,CAAA,CAAE,cAAc,cAAA,GAAiB,CAAA,CAAE,WAAW,cAAA,IAAkB;AAAA;AAC1E,KACF;AACA,IAAA,OAAO,iBAAA,GAAoB,GAAA;AAAA,EAC7B;AAAA,EAEQ,kBAAkB,QAAA,EAAoC;AAC5D,IAAA,IAAI,QAAA,CAAS,MAAA,KAAW,CAAA,EAAG,OAAO,KAAA;AAClC,IAAA,MAAM,cAAA,GAAiB,QAAA,CAAS,KAAA,CAAM,EAAE,CAAA;AACxC,IAAA,MAAM,cAAc,IAAA,CAAK,OAAA;AAAA,MACvB,cAAA,CAAe,GAAA,CAAI,CAAC,CAAA,KAAM;AACxB,QAAA,MAAM,gBAAA,GAAmB,CAAA,GAAI,CAAA,CAAE,aAAA,CAAc,OAAA;AAC7C,QAAA,MAAM,aAAA,GAAgB,CAAA,GAAI,CAAA,CAAE,UAAA,CAAW,OAAA;AACvC,QAAA,OAAA,CAAQ,mBAAmB,aAAA,IAAiB,CAAA;AAAA,MAC9C,CAAC;AAAA,KACH;AACA,IAAA,OAAO,WAAA,GAAc,GAAA;AAAA,EACvB;AAAA,EAEQ,sBAAsB,QAAA,EAAoC;AAChE,IAAA,IAAI,WAAA,GAAc,CAAA;AAClB,IAAA,IAAI,UAAA,GAAa,CAAA;AAEjB,IAAA,KAAA,MAAW,OAAA,IAAW,QAAA,CAAS,KAAA,CAAM,EAAE,CAAA,EAAG;AACxC,MAAA,MAAM,SAAS,OAAA,CAAQ,MAAA;AACvB,MAAA,IAAI,MAAA,CAAO,SAAS,EAAA,EAAI;AAExB,MAAA,MAAM,SAAA,GAAY,OAAO,KAAA,CAAM,CAAA,EAAG,KAAK,KAAA,CAAM,MAAA,CAAO,MAAA,GAAS,CAAC,CAAC,CAAA;AAC/D,MAAA,MAAM,UAAA,GAAa,OAAO,KAAA,CAAM,IAAA,CAAK,MAAM,MAAA,CAAO,MAAA,GAAS,CAAC,CAAC,CAAA;AAE7D,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,sBAAA,CAAuB,SAAS,CAAA;AACtD,MAAA,MAAM,SAAA,GAAY,IAAA,CAAK,sBAAA,CAAuB,UAAU,CAAA;AAExD,MAAA,IAAI,QAAA,GAAW,YAAY,CAAA,EAAG,WAAA,EAAA;AAAA,WAAA,IACrB,SAAA,GAAY,WAAW,CAAA,EAAG,UAAA,EAAA;AAAA,IACrC;AAEA,IAAA,OAAO,WAAA,GAAc,UAAA;AAAA,EACvB;AAAA,EAEQ,qBAAqB,QAAA,EAAoC;AAC/D,IAAA,IAAI,WAAA,GAAc,CAAA;AAClB,IAAA,IAAI,UAAA,GAAa,CAAA;AAEjB,IAAA,KAAA,MAAW,OAAA,IAAW,QAAA,CAAS,KAAA,CAAM,EAAE,CAAA,EAAG;AACxC,MAAA,MAAM,SAAS,OAAA,CAAQ,MAAA;AACvB,MAAA,IAAI,MAAA,CAAO,SAAS,EAAA,EAAI;AAExB,MAAA,MAAM,SAAA,GAAY,OAAO,KAAA,CAAM,CAAA,EAAG,KAAK,KAAA,CAAM,MAAA,CAAO,MAAA,GAAS,CAAC,CAAC,CAAA;AAC/D,MAAA,MAAM,UAAA,GAAa,OAAO,KAAA,CAAM,IAAA,CAAK,MAAM,MAAA,CAAO,MAAA,GAAS,CAAC,CAAC,CAAA;AAE7D,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,sBAAA,CAAuB,SAAS,CAAA;AACtD,MAAA,MAAM,SAAA,GAAY,IAAA,CAAK,sBAAA,CAAuB,UAAU,CAAA;AAExD,MAAA,IAAI,QAAA,GAAW,YAAY,CAAA,EAAG,WAAA,EAAA;AAAA,WAAA,IACrB,SAAA,GAAY,WAAW,CAAA,EAAG,UAAA,EAAA;AAAA,IACrC;AAEA,IAAA,OAAO,UAAA,GAAa,WAAA;AAAA,EACtB;AACF;AAKO,SAAS,qBAAA,GAAyC;AACvD,EAAA,OAAO,IAAI,eAAA,EAAgB;AAC7B","file":"index.js","sourcesContent":["/**\n * TrainingMode Value Object\n *\n * Represents the type of N-back training:\n * - single-position: Track position matches only\n * - single-audio: Track audio (letter) matches only\n * - dual: Track both position AND audio matches simultaneously\n */\n\nexport type TrainingMode = 'single-position' | 'single-audio' | 'dual';\n\n/**\n * All available training modes\n */\nexport const TRAINING_MODES: readonly TrainingMode[] = [\n  'single-position',\n  'single-audio',\n  'dual',\n] as const;\n\n/**\n * Validates if a string is a valid training mode\n */\nexport function isValidTrainingMode(value: string): value is TrainingMode {\n  return TRAINING_MODES.includes(value as TrainingMode);\n}\n\n/**\n * Returns human-readable name for a training mode\n */\nexport function getTrainingModeName(mode: TrainingMode): string {\n  switch (mode) {\n    case 'single-position':\n      return 'Position Only';\n    case 'single-audio':\n      return 'Audio Only';\n    case 'dual':\n      return 'Dual N-Back';\n  }\n}\n\n/**\n * Checks if a training mode includes position tracking\n */\nexport function modeIncludesPosition(mode: TrainingMode): boolean {\n  return mode === 'single-position' || mode === 'dual';\n}\n\n/**\n * Checks if a training mode includes audio tracking\n */\nexport function modeIncludesAudio(mode: TrainingMode): boolean {\n  return mode === 'single-audio' || mode === 'dual';\n}\n","/**\n * SequenceGenerator Service\n *\n * Generates pseudo-random sequences for training sessions.\n * Ensures appropriate match frequency based on N-back level.\n * Supports seeded RNG for reproducible sequences.\n */\n\nimport type { NBackLevel } from '../domain/value-objects/NBackLevel';\nimport type { TrainingMode } from '../domain/value-objects/TrainingMode';\nimport { modeIncludesPosition, modeIncludesAudio } from '../domain/value-objects/TrainingMode';\n\n/**\n * Configuration for sequence generation\n */\nexport interface SequenceConfig {\n  /** N-back level (1-9) */\n  nBack: NBackLevel;\n  /** Number of trials to generate */\n  trialCount: number;\n  /** Training mode */\n  mode: TrainingMode;\n  /** Probability of position match (default: 0.3) */\n  positionMatchProbability?: number;\n  /** Probability of audio match (default: 0.3) */\n  audioMatchProbability?: number;\n  /** Optional seed for reproducible sequences */\n  seed?: number;\n}\n\n/**\n * Represents a generated trial in the sequence\n */\nexport interface GeneratedTrial {\n  /** Position index (0-8) for 3x3 grid */\n  position: number;\n  /** Letter to speak */\n  audioLetter: string;\n  /** Whether this trial is a position match */\n  isPositionMatch: boolean;\n  /** Whether this trial is an audio match */\n  isAudioMatch: boolean;\n}\n\n/**\n * Simple seeded pseudo-random number generator (Mulberry32)\n * Provides reproducible random sequences when a seed is provided\n */\nfunction createSeededRandom(seed: number): () => number {\n  let state = seed;\n  return () => {\n    state = (state + 0x6d2b79f5) | 0;\n    let t = Math.imul(state ^ (state >>> 15), 1 | state);\n    t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;\n    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;\n  };\n}\n\n/**\n * SequenceGenerator\n *\n * Generates training sequences with controlled match probabilities.\n * Prevents consecutive matches and uses phonetically distinct letters.\n */\nexport class SequenceGenerator {\n  /**\n   * Available letters for audio stimuli\n   * Phonetically distinct to avoid confusion when spoken\n   * Excludes similar-sounding pairs (B/D, C/E, F/S, M/N, P/B, etc.)\n   */\n  private static readonly LETTERS = ['C', 'H', 'K', 'L', 'Q', 'R', 'S', 'T'];\n\n  /** Number of positions in the 3x3 grid */\n  private static readonly GRID_SIZE = 9;\n\n  /** Default match probability */\n  private static readonly DEFAULT_MATCH_PROBABILITY = 0.3;\n\n  /**\n   * Generates a sequence of trials based on the provided configuration\n   */\n  generate(config: SequenceConfig): GeneratedTrial[] {\n    const {\n      nBack,\n      trialCount,\n      mode,\n      positionMatchProbability = SequenceGenerator.DEFAULT_MATCH_PROBABILITY,\n      audioMatchProbability = SequenceGenerator.DEFAULT_MATCH_PROBABILITY,\n      seed,\n    } = config;\n\n    // Use seeded RNG if seed provided, otherwise use Math.random\n    const random = seed !== undefined ? createSeededRandom(seed) : Math.random.bind(Math);\n\n    const trials: GeneratedTrial[] = [];\n    const positions: number[] = [];\n    const letters: string[] = [];\n\n    const includesPosition = modeIncludesPosition(mode);\n    const includesAudio = modeIncludesAudio(mode);\n\n    for (let i = 0; i < trialCount; i++) {\n      let position: number;\n      let letter: string;\n      let isPositionMatch = false;\n      let isAudioMatch = false;\n\n      // Can only be a match after n-back warmup trials\n      const canBeMatch = i >= nBack;\n\n      // Determine if this trial should be a position match\n      const shouldBePositionMatch =\n        canBeMatch &&\n        includesPosition &&\n        random() < positionMatchProbability &&\n        !this.wasRecentMatch(trials, 'position', nBack);\n\n      // Determine if this trial should be an audio match\n      const shouldBeAudioMatch =\n        canBeMatch &&\n        includesAudio &&\n        random() < audioMatchProbability &&\n        !this.wasRecentMatch(trials, 'audio', nBack);\n\n      // Generate position\n      if (shouldBePositionMatch && positions.length >= nBack) {\n        position = positions[i - nBack]!;\n        isPositionMatch = true;\n      } else {\n        // Generate random position, avoiding match if we shouldn't match\n        const excludePosition = canBeMatch && positions.length >= nBack ? positions[i - nBack] : -1;\n        position = this.randomPositionExcluding(excludePosition!, random);\n      }\n\n      // Generate audio letter\n      if (shouldBeAudioMatch && letters.length >= nBack) {\n        letter = letters[i - nBack]!;\n        isAudioMatch = true;\n      } else {\n        // Generate random letter, avoiding match if we shouldn't match\n        const excludeLetter = canBeMatch && letters.length >= nBack ? letters[i - nBack] : '';\n        letter = this.randomLetterExcluding(excludeLetter!, random);\n      }\n\n      positions.push(position);\n      letters.push(letter);\n      trials.push({\n        position,\n        audioLetter: letter,\n        isPositionMatch,\n        isAudioMatch,\n      });\n    }\n\n    return trials;\n  }\n\n  /**\n   * Checks if there was a match in the most recent trial\n   * Used to prevent consecutive matches which create predictable patterns\n   */\n  private wasRecentMatch(\n    trials: GeneratedTrial[],\n    type: 'position' | 'audio',\n    nBack: number\n  ): boolean {\n    if (trials.length === 0) return false;\n    const lastTrial = trials[trials.length - 1]!;\n    return type === 'position' ? lastTrial.isPositionMatch : lastTrial.isAudioMatch;\n  }\n\n  /**\n   * Generates a random position, excluding the specified position\n   */\n  private randomPositionExcluding(exclude: number, random: () => number): number {\n    let pos: number;\n    do {\n      pos = Math.floor(random() * SequenceGenerator.GRID_SIZE);\n    } while (pos === exclude);\n    return pos;\n  }\n\n  /**\n   * Generates a random letter, excluding the specified letter\n   */\n  private randomLetterExcluding(exclude: string, random: () => number): string {\n    let letter: string;\n    do {\n      letter = SequenceGenerator.LETTERS[\n        Math.floor(random() * SequenceGenerator.LETTERS.length)\n      ]!;\n    } while (letter === exclude);\n    return letter;\n  }\n\n  /**\n   * Returns the available letters used for audio stimuli\n   */\n  static getAvailableLetters(): readonly string[] {\n    return SequenceGenerator.LETTERS;\n  }\n\n  /**\n   * Returns the grid size (number of positions)\n   */\n  static getGridSize(): number {\n    return SequenceGenerator.GRID_SIZE;\n  }\n}\n\n/**\n * Factory function to create a SequenceGenerator instance\n */\nexport function createSequenceGenerator(): SequenceGenerator {\n  return new SequenceGenerator();\n}\n","/**\n * PerformanceStats Value Object\n *\n * Represents performance metrics for a session or trial set.\n * Uses signal detection theory metrics (d-prime) for cognitive assessment.\n */\n\n/**\n * Performance statistics calculated from session trials\n */\nexport interface PerformanceStats {\n  /** Number of correct match identifications (hits) */\n  readonly hits: number;\n  /** Number of missed matches (misses) */\n  readonly misses: number;\n  /** Number of incorrect match claims (false alarms) */\n  readonly falseAlarms: number;\n  /** Number of correctly identified non-matches */\n  readonly correctRejections: number;\n  /** Hit rate: hits / (hits + misses) */\n  readonly hitRate: number;\n  /** False alarm rate: falseAlarms / (falseAlarms + correctRejections) */\n  readonly falseAlarmRate: number;\n  /** D-prime: sensitivity measure from signal detection theory */\n  readonly dPrime: number;\n  /** Overall accuracy percentage (0-100) */\n  readonly accuracy: number;\n  /** Average response time in milliseconds (null if no responses) */\n  readonly avgResponseTime: number | null;\n}\n\n/**\n * Raw counts for calculating performance stats\n */\nexport interface PerformanceRawCounts {\n  hits: number;\n  misses: number;\n  falseAlarms: number;\n  correctRejections: number;\n  responseTimes: number[];\n}\n\n/**\n * Calculates z-score for d-prime calculation\n * Uses approximation of inverse normal CDF\n */\nfunction zScore(p: number): number {\n  // Clamp to avoid infinity\n  const clampedP = Math.max(0.001, Math.min(0.999, p));\n\n  // Approximation using Abramowitz and Stegun formula\n  const a1 = -39.6968302866538;\n  const a2 = 220.946098424521;\n  const a3 = -275.928510446969;\n  const a4 = 138.357751867269;\n  const a5 = -30.6647980661472;\n  const a6 = 2.50662823884;\n\n  const b1 = -54.4760987982241;\n  const b2 = 161.585836858041;\n  const b3 = -155.698979859887;\n  const b4 = 66.8013118877197;\n  const b5 = -13.2806815528857;\n\n  const c1 = -7.78489400243029e-3;\n  const c2 = -0.322396458041136;\n  const c3 = -2.40075827716184;\n  const c4 = -2.54973253934373;\n  const c5 = 4.37466414146497;\n  const c6 = 2.93816398269878;\n\n  const d1 = 7.78469570904146e-3;\n  const d2 = 0.32246712907004;\n  const d3 = 2.445134137143;\n  const d4 = 3.75440866190742;\n\n  const pLow = 0.02425;\n  const pHigh = 1 - pLow;\n\n  let q: number;\n  let r: number;\n\n  if (clampedP < pLow) {\n    q = Math.sqrt(-2 * Math.log(clampedP));\n    return (\n      (((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) /\n      ((((d1 * q + d2) * q + d3) * q + d4) * q + 1)\n    );\n  } else if (clampedP <= pHigh) {\n    q = clampedP - 0.5;\n    r = q * q;\n    return (\n      ((((((a1 * r + a2) * r + a3) * r + a4) * r + a5) * r + a6) * q) /\n      (((((b1 * r + b2) * r + b3) * r + b4) * r + b5) * r + 1)\n    );\n  } else {\n    q = Math.sqrt(-2 * Math.log(1 - clampedP));\n    return (\n      -(((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) /\n      ((((d1 * q + d2) * q + d3) * q + d4) * q + 1)\n    );\n  }\n}\n\n/**\n * Creates PerformanceStats from raw counts\n */\nexport function createPerformanceStats(counts: PerformanceRawCounts): PerformanceStats {\n  const { hits, misses, falseAlarms, correctRejections, responseTimes } = counts;\n\n  const totalSignals = hits + misses;\n  const totalNoise = falseAlarms + correctRejections;\n  const total = totalSignals + totalNoise;\n\n  // Calculate rates with edge case handling\n  const hitRate = totalSignals > 0 ? hits / totalSignals : 0;\n  const falseAlarmRate = totalNoise > 0 ? falseAlarms / totalNoise : 0;\n\n  // Calculate d-prime\n  const dPrime = zScore(hitRate) - zScore(falseAlarmRate);\n\n  // Calculate accuracy\n  const correctResponses = hits + correctRejections;\n  const accuracy = total > 0 ? (correctResponses / total) * 100 : 0;\n\n  // Calculate average response time\n  const avgResponseTime =\n    responseTimes.length > 0\n      ? responseTimes.reduce((sum, t) => sum + t, 0) / responseTimes.length\n      : null;\n\n  return {\n    hits,\n    misses,\n    falseAlarms,\n    correctRejections,\n    hitRate,\n    falseAlarmRate,\n    dPrime,\n    accuracy,\n    avgResponseTime,\n  };\n}\n\n/**\n * Creates empty performance stats (for initial state)\n */\nexport function createEmptyPerformanceStats(): PerformanceStats {\n  return {\n    hits: 0,\n    misses: 0,\n    falseAlarms: 0,\n    correctRejections: 0,\n    hitRate: 0,\n    falseAlarmRate: 0,\n    dPrime: 0,\n    accuracy: 0,\n    avgResponseTime: null,\n  };\n}\n","/**\n * ScoringService\n *\n * Calculates performance metrics including accuracy and d-prime scores.\n * Uses signal detection theory for cognitive assessment.\n */\n\nimport type { TrainingMode } from '../domain/value-objects/TrainingMode';\nimport type { PerformanceStats, PerformanceRawCounts } from '../domain/value-objects/PerformanceStats';\nimport { createPerformanceStats, createEmptyPerformanceStats } from '../domain/value-objects/PerformanceStats';\n\n/**\n * Represents a single trial result for scoring\n */\nexport interface TrialResult {\n  /** Whether this trial was a match (signal) */\n  isMatch: boolean;\n  /** Whether the user responded (claimed match) */\n  userResponse: boolean | null;\n  /** Response time in milliseconds (null if no response) */\n  responseTime: number | null;\n}\n\n/**\n * Dual trial result for position and audio\n */\nexport interface DualTrialResult {\n  position: TrialResult;\n  audio: TrialResult;\n}\n\n/**\n * Combined session result with separate position/audio stats\n */\nexport interface SessionScoringResult {\n  /** Position performance stats */\n  positionStats: PerformanceStats;\n  /** Audio performance stats */\n  audioStats: PerformanceStats;\n  /** Combined accuracy (mode-dependent weighting) */\n  combinedAccuracy: number;\n  /** Combined d-prime */\n  combinedDPrime: number;\n}\n\n/**\n * ScoringService\n *\n * Provides methods for calculating performance statistics from trial results.\n * Handles edge cases and uses signal detection theory metrics.\n */\nexport class ScoringService {\n  /**\n   * Calculate performance statistics from a set of trial results\n   */\n  calculateStats(trials: TrialResult[]): PerformanceStats {\n    if (trials.length === 0) {\n      return createEmptyPerformanceStats();\n    }\n\n    const counts: PerformanceRawCounts = {\n      hits: 0,\n      misses: 0,\n      falseAlarms: 0,\n      correctRejections: 0,\n      responseTimes: [],\n    };\n\n    for (const trial of trials) {\n      const userResponded = trial.userResponse === true;\n\n      if (trial.isMatch) {\n        // Signal trial\n        if (userResponded) {\n          counts.hits++;\n        } else {\n          counts.misses++;\n        }\n      } else {\n        // Noise trial\n        if (userResponded) {\n          counts.falseAlarms++;\n        } else {\n          counts.correctRejections++;\n        }\n      }\n\n      // Collect response times\n      if (trial.responseTime !== null) {\n        counts.responseTimes.push(trial.responseTime);\n      }\n    }\n\n    return createPerformanceStats(counts);\n  }\n\n  /**\n   * Calculate performance statistics with log-linear correction\n   * This version applies correction for extreme rates (0 or 1)\n   * to prevent infinite d-prime values\n   */\n  calculateStatsWithCorrection(trials: TrialResult[]): PerformanceStats {\n    if (trials.length === 0) {\n      return createEmptyPerformanceStats();\n    }\n\n    let hits = 0;\n    let misses = 0;\n    let falseAlarms = 0;\n    let correctRejections = 0;\n    const responseTimes: number[] = [];\n\n    for (const trial of trials) {\n      const userResponded = trial.userResponse === true;\n\n      if (trial.isMatch) {\n        if (userResponded) {\n          hits++;\n        } else {\n          misses++;\n        }\n      } else {\n        if (userResponded) {\n          falseAlarms++;\n        } else {\n          correctRejections++;\n        }\n      }\n\n      if (trial.responseTime !== null) {\n        responseTimes.push(trial.responseTime);\n      }\n    }\n\n    const totalSignals = hits + misses;\n    const totalNoise = falseAlarms + correctRejections;\n    const total = totalSignals + totalNoise;\n\n    // Apply log-linear correction: (count + 0.5) / (total + 1)\n    const hitRate = totalSignals > 0 ? (hits + 0.5) / (totalSignals + 1) : 0.5;\n    const falseAlarmRate = totalNoise > 0 ? (falseAlarms + 0.5) / (totalNoise + 1) : 0.5;\n\n    // Calculate d-prime with corrected rates\n    const dPrime = this.calculateDPrime(hitRate, falseAlarmRate);\n\n    // Calculate accuracy (no correction needed)\n    const correctResponses = hits + correctRejections;\n    const accuracy = total > 0 ? (correctResponses / total) * 100 : 0;\n\n    // Calculate average response time\n    const avgResponseTime =\n      responseTimes.length > 0\n        ? responseTimes.reduce((sum, t) => sum + t, 0) / responseTimes.length\n        : null;\n\n    return {\n      hits,\n      misses,\n      falseAlarms,\n      correctRejections,\n      hitRate,\n      falseAlarmRate,\n      dPrime,\n      accuracy,\n      avgResponseTime,\n    };\n  }\n\n  /**\n   * Calculate d-prime using inverse normal CDF\n   * d' = Z(hitRate) - Z(falseAlarmRate)\n   */\n  calculateDPrime(hitRate: number, falseAlarmRate: number): number {\n    // Clamp rates to avoid infinity\n    const clampedHR = Math.max(0.01, Math.min(0.99, hitRate));\n    const clampedFAR = Math.max(0.01, Math.min(0.99, falseAlarmRate));\n\n    const zHR = this.inverseNormalCDF(clampedHR);\n    const zFAR = this.inverseNormalCDF(clampedFAR);\n\n    return Number((zHR - zFAR).toFixed(2));\n  }\n\n  /**\n   * Approximate inverse normal CDF (probit function)\n   * Using Abramowitz and Stegun approximation\n   */\n  private inverseNormalCDF(p: number): number {\n    // Coefficients for rational approximation\n    const a = [\n      -3.969683028665376e1,\n      2.209460984245205e2,\n      -2.759285104469687e2,\n      1.383577518672690e2,\n      -3.066479806614716e1,\n      2.506628277459239e0,\n    ];\n    const b = [\n      -5.447609879822406e1,\n      1.615858368580409e2,\n      -1.556989798598866e2,\n      6.680131188771972e1,\n      -1.328068155288572e1,\n    ];\n    const c = [\n      -7.784894002430293e-3,\n      -3.223964580411365e-1,\n      -2.400758277161838e0,\n      -2.549732539343734e0,\n      4.374664141464968e0,\n      2.938163982698783e0,\n    ];\n    const d = [\n      7.784695709041462e-3,\n      3.224671290700398e-1,\n      2.445134137142996e0,\n      3.754408661907416e0,\n    ];\n\n    const pLow = 0.02425;\n    const pHigh = 1 - pLow;\n\n    let q: number;\n    let r: number;\n\n    if (p < pLow) {\n      q = Math.sqrt(-2 * Math.log(p));\n      return (\n        (((((c[0]! * q + c[1]!) * q + c[2]!) * q + c[3]!) * q + c[4]!) * q + c[5]!) /\n        ((((d[0]! * q + d[1]!) * q + d[2]!) * q + d[3]!) * q + 1)\n      );\n    } else if (p <= pHigh) {\n      q = p - 0.5;\n      r = q * q;\n      return (\n        ((((((a[0]! * r + a[1]!) * r + a[2]!) * r + a[3]!) * r + a[4]!) * r + a[5]!) * q) /\n        (((((b[0]! * r + b[1]!) * r + b[2]!) * r + b[3]!) * r + b[4]!) * r + 1)\n      );\n    } else {\n      q = Math.sqrt(-2 * Math.log(1 - p));\n      return (\n        -(((((c[0]! * q + c[1]!) * q + c[2]!) * q + c[3]!) * q + c[4]!) * q + c[5]!) /\n        ((((d[0]! * q + d[1]!) * q + d[2]!) * q + d[3]!) * q + 1)\n      );\n    }\n  }\n\n  /**\n   * Calculate full session result from position and audio trials\n   */\n  calculateSessionResult(\n    positionTrials: TrialResult[],\n    audioTrials: TrialResult[],\n    mode: TrainingMode\n  ): SessionScoringResult {\n    const positionStats = this.calculateStatsWithCorrection(positionTrials);\n    const audioStats = this.calculateStatsWithCorrection(audioTrials);\n\n    let combinedAccuracy: number;\n    let combinedDPrime: number;\n\n    switch (mode) {\n      case 'single-position':\n        combinedAccuracy = positionStats.accuracy;\n        combinedDPrime = positionStats.dPrime;\n        break;\n      case 'single-audio':\n        combinedAccuracy = audioStats.accuracy;\n        combinedDPrime = audioStats.dPrime;\n        break;\n      case 'dual':\n        // Average of both for dual mode\n        combinedAccuracy = (positionStats.accuracy + audioStats.accuracy) / 2;\n        combinedDPrime = (positionStats.dPrime + audioStats.dPrime) / 2;\n        break;\n    }\n\n    return {\n      positionStats,\n      audioStats,\n      combinedAccuracy,\n      combinedDPrime,\n    };\n  }\n\n  /**\n   * Calculate session result from dual trial results\n   */\n  calculateDualSessionResult(\n    trials: DualTrialResult[],\n    mode: TrainingMode\n  ): SessionScoringResult {\n    const positionTrials = trials.map((t) => t.position);\n    const audioTrials = trials.map((t) => t.audio);\n\n    return this.calculateSessionResult(positionTrials, audioTrials, mode);\n  }\n\n  /**\n   * Determine performance level based on d-prime\n   * Used for progression decisions\n   */\n  getPerformanceLevel(dPrime: number): 'poor' | 'fair' | 'good' | 'excellent' {\n    if (dPrime < 1) return 'poor';\n    if (dPrime < 2) return 'fair';\n    if (dPrime < 3) return 'good';\n    return 'excellent';\n  }\n\n  /**\n   * Check if performance meets advancement criteria\n   * Default threshold is d-prime >= 2.0\n   */\n  meetsAdvancementCriteria(dPrime: number, threshold = 2.0): boolean {\n    return dPrime >= threshold;\n  }\n}\n\n/**\n * Factory function to create a ScoringService instance\n */\nexport function createScoringService(): ScoringService {\n  return new ScoringService();\n}\n","/**\n * ProfileAnalyzer Service\n *\n * Analyzes user behavior patterns across sessions.\n * Builds user profiles for personalized feedback and LLM recommendations.\n */\n\nimport type { SessionResult } from '../domain/entities/Session';\nimport type { UserProgress } from '../ports/IProgressRepository';\nimport type { AnalyticsEvent } from '../ports/IAnalyticsRepository';\nimport type { UserProfile } from '../domain/entities/UserProfile';\n\n/**\n * Error pattern identified in user behavior\n */\nexport interface ErrorPattern {\n  type: 'position_miss' | 'audio_miss' | 'position_false_alarm' | 'audio_false_alarm';\n  frequency: number;\n  context: string;\n}\n\n/**\n * Fatigue indicator detected in session performance\n */\nexport interface FatigueIndicator {\n  type: 'accuracy_drop' | 'response_slowdown' | 'error_spike';\n  typicalOnset: number;\n  severity: 'mild' | 'moderate' | 'severe';\n}\n\n/**\n * Comprehensive behavioral profile for LLM consumption\n */\nexport interface UserBehavioralProfile {\n  performance: {\n    averageAccuracy: number;\n    accuracyTrend: 'improving' | 'stable' | 'declining';\n    averageResponseTime: number;\n    responseTimeTrend: 'faster' | 'stable' | 'slower';\n    positionStrength: number;\n    audioStrength: number;\n    commonErrorPatterns: ErrorPattern[];\n    fatigueIndicators: FatigueIndicator[];\n  };\n\n  learning: {\n    currentLevel: string;\n    progressionRate: 'fast' | 'normal' | 'slow';\n    levelsCompleted: number;\n    averageAttemptsPerLevel: number;\n    plateauDetected: boolean;\n    plateauDuration: number | null;\n    recommendedNextLevel: string | null;\n  };\n\n  engagement: {\n    totalSessions: number;\n    sessionsThisWeek: number;\n    averageSessionsPerWeek: number;\n    preferredTimeOfDay: 'morning' | 'afternoon' | 'evening' | 'night' | null;\n    averageSessionDuration: number;\n    currentStreak: number;\n    longestStreak: number;\n    lastSessionDate: Date | null;\n    daysSinceLastSession: number | null;\n  };\n\n  helpSeeking: {\n    popoverViewCount: number;\n    averagePopoverDuration: number;\n    tourCompleted: boolean;\n    frequentlyViewedHelp: string[];\n    helpViewTrend: 'increasing' | 'stable' | 'decreasing';\n  };\n\n  insights: {\n    strengths: string[];\n    areasForImprovement: string[];\n    motivationalFactors: string[];\n    riskOfChurn: 'low' | 'medium' | 'high';\n    suggestedInterventions: string[];\n  };\n\n  profileGeneratedAt: Date;\n  dataPointCount: number;\n}\n\n/**\n * ProfileAnalyzer Service\n *\n * Builds comprehensive user behavioral profiles from session and analytics data.\n */\nexport class ProfileAnalyzer {\n  /**\n   * Build a comprehensive behavioral profile\n   */\n  buildBehavioralProfile(\n    sessions: SessionResult[],\n    progress: UserProgress,\n    events: AnalyticsEvent[]\n  ): UserBehavioralProfile {\n    return {\n      performance: this.analyzePerformance(sessions),\n      learning: this.analyzeLearning(sessions, progress),\n      engagement: this.analyzeEngagement(sessions, progress),\n      helpSeeking: this.analyzeHelpSeeking(events),\n      insights: this.generateInsights(sessions, progress, events),\n      profileGeneratedAt: new Date(),\n      dataPointCount: sessions.length + events.length,\n    };\n  }\n\n  /**\n   * Build a simplified UserProfile (for existing interface compatibility)\n   */\n  buildUserProfile(\n    sessions: SessionResult[],\n    progress: UserProgress,\n    events: AnalyticsEvent[]\n  ): UserProfile {\n    const behavioral = this.buildBehavioralProfile(sessions, progress, events);\n    const nBackLevel = this.extractNBackLevel(progress.currentLevel);\n\n    return {\n      id: 'user-profile',\n      currentLevel: nBackLevel,\n      totalSessions: progress.totalSessions,\n      totalTrainingTime: progress.totalTime,\n      currentStreak: progress.currentStreak,\n      longestStreak: progress.longestStreak,\n      preferences: {\n        preferredTimeOfDay: behavioral.engagement.preferredTimeOfDay,\n        averageSessionDuration: behavioral.engagement.averageSessionDuration,\n        preferredMode: null,\n        sessionsPerWeek: behavioral.engagement.averageSessionsPerWeek,\n      },\n      trends: {\n        overallTrend: behavioral.performance.accuracyTrend,\n        positionTrend: behavioral.performance.accuracyTrend,\n        audioTrend: behavioral.performance.accuracyTrend,\n        recentAccuracies: sessions.slice(-10).map((s) => s.combinedAccuracy),\n      },\n      strengthsWeaknesses: {\n        strongerModality: this.determineStrongerModality(\n          behavioral.performance.positionStrength,\n          behavioral.performance.audioStrength\n        ),\n        consistentlyStrugglesAt: null,\n        consistentlyExcelsAt: null,\n      },\n      behavioralPatterns: {\n        respondsQuicklyToPosition: behavioral.performance.averageResponseTime < 1000,\n        respondsQuicklyToAudio: behavioral.performance.averageResponseTime < 1000,\n        tendsToPressMatchTooOften: this.checkFalseAlarmTendency(sessions),\n        tendsToPressMatchTooRarely: this.checkMissTendency(sessions),\n        performsBetterEarlyInSession: this.checkEarlyPerformance(sessions),\n        performsBetterLateInSession: this.checkLatePerformance(sessions),\n      },\n      lastUpdated: new Date(),\n    };\n  }\n\n  // ============================================================================\n  // Performance Analysis\n  // ============================================================================\n\n  private analyzePerformance(sessions: SessionResult[]) {\n    if (sessions.length === 0) {\n      return this.getDefaultPerformance();\n    }\n\n    const recentSessions = sessions.slice(-10);\n    const accuracies = recentSessions.map((s) => s.combinedAccuracy);\n    const avgAccuracy = this.average(accuracies);\n    const accuracyTrend = this.calculateTrend(accuracies);\n\n    const responseTimes = this.extractResponseTimes(recentSessions);\n    const avgResponseTime = this.average(responseTimes);\n    const responseTimeTrend = this.calculateResponseTimeTrend(responseTimes);\n\n    const positionAccuracies = recentSessions.map((s) => s.positionStats.accuracy);\n    const audioAccuracies = recentSessions.map((s) => s.audioStats.accuracy);\n\n    return {\n      averageAccuracy: avgAccuracy,\n      accuracyTrend,\n      averageResponseTime: avgResponseTime,\n      responseTimeTrend,\n      positionStrength: this.average(positionAccuracies) / 100,\n      audioStrength: this.average(audioAccuracies) / 100,\n      commonErrorPatterns: this.findErrorPatterns(recentSessions),\n      fatigueIndicators: this.detectFatigue(recentSessions),\n    };\n  }\n\n  private getDefaultPerformance() {\n    return {\n      averageAccuracy: 0,\n      accuracyTrend: 'stable' as const,\n      averageResponseTime: 0,\n      responseTimeTrend: 'stable' as const,\n      positionStrength: 0.5,\n      audioStrength: 0.5,\n      commonErrorPatterns: [],\n      fatigueIndicators: [],\n    };\n  }\n\n  private extractResponseTimes(sessions: SessionResult[]): number[] {\n    const times: number[] = [];\n    for (const session of sessions) {\n      for (const trial of session.trials) {\n        if (trial.positionResponseTime !== null) {\n          times.push(trial.positionResponseTime);\n        }\n        if (trial.audioResponseTime !== null) {\n          times.push(trial.audioResponseTime);\n        }\n      }\n    }\n    return times;\n  }\n\n  private findErrorPatterns(sessions: SessionResult[]): ErrorPattern[] {\n    const patterns: ErrorPattern[] = [];\n    let positionMisses = 0;\n    let audioMisses = 0;\n    let positionFalseAlarms = 0;\n    let audioFalseAlarms = 0;\n    let totalTrials = 0;\n\n    for (const session of sessions) {\n      for (const trial of session.trials) {\n        totalTrials++;\n        if (trial.isPositionMatch && trial.userPositionResponse !== true) {\n          positionMisses++;\n        }\n        if (trial.isAudioMatch && trial.userAudioResponse !== true) {\n          audioMisses++;\n        }\n        if (!trial.isPositionMatch && trial.userPositionResponse === true) {\n          positionFalseAlarms++;\n        }\n        if (!trial.isAudioMatch && trial.userAudioResponse === true) {\n          audioFalseAlarms++;\n        }\n      }\n    }\n\n    if (totalTrials > 0) {\n      const missThreshold = 0.15;\n      const faThreshold = 0.1;\n\n      if (positionMisses / totalTrials > missThreshold) {\n        patterns.push({\n          type: 'position_miss',\n          frequency: positionMisses / totalTrials,\n          context: 'Frequently missing position matches',\n        });\n      }\n      if (audioMisses / totalTrials > missThreshold) {\n        patterns.push({\n          type: 'audio_miss',\n          frequency: audioMisses / totalTrials,\n          context: 'Frequently missing audio matches',\n        });\n      }\n      if (positionFalseAlarms / totalTrials > faThreshold) {\n        patterns.push({\n          type: 'position_false_alarm',\n          frequency: positionFalseAlarms / totalTrials,\n          context: 'Frequent false alarms on position',\n        });\n      }\n      if (audioFalseAlarms / totalTrials > faThreshold) {\n        patterns.push({\n          type: 'audio_false_alarm',\n          frequency: audioFalseAlarms / totalTrials,\n          context: 'Frequent false alarms on audio',\n        });\n      }\n    }\n\n    return patterns;\n  }\n\n  private detectFatigue(sessions: SessionResult[]): FatigueIndicator[] {\n    const indicators: FatigueIndicator[] = [];\n\n    for (const session of sessions) {\n      const trials = session.trials;\n      if (trials.length < 10) continue;\n\n      const firstHalf = trials.slice(0, Math.floor(trials.length / 2));\n      const secondHalf = trials.slice(Math.floor(trials.length / 2));\n\n      const firstHalfCorrect = this.calculateTrialAccuracy(firstHalf);\n      const secondHalfCorrect = this.calculateTrialAccuracy(secondHalf);\n\n      if (firstHalfCorrect - secondHalfCorrect > 15) {\n        indicators.push({\n          type: 'accuracy_drop',\n          typicalOnset: Math.floor(trials.length / 2),\n          severity: firstHalfCorrect - secondHalfCorrect > 25 ? 'severe' : 'moderate',\n        });\n      }\n    }\n\n    return indicators;\n  }\n\n  private calculateTrialAccuracy(trials: SessionResult['trials']): number {\n    if (trials.length === 0) return 0;\n    let correct = 0;\n    let total = 0;\n\n    for (const trial of trials) {\n      if (trial.userPositionResponse !== null || trial.isPositionMatch) {\n        total++;\n        if (trial.userPositionResponse === trial.isPositionMatch) {\n          correct++;\n        }\n      }\n      if (trial.userAudioResponse !== null || trial.isAudioMatch) {\n        total++;\n        if (trial.userAudioResponse === trial.isAudioMatch) {\n          correct++;\n        }\n      }\n    }\n\n    return total > 0 ? (correct / total) * 100 : 0;\n  }\n\n  // ============================================================================\n  // Learning Analysis\n  // ============================================================================\n\n  private analyzeLearning(sessions: SessionResult[], progress: UserProgress) {\n    const levelHistory = this.getLevelHistory(sessions);\n    const progressionRate = this.calculateProgressionRate(sessions, progress);\n    const plateauInfo = this.detectPlateau(sessions);\n\n    return {\n      currentLevel: progress.currentLevel,\n      progressionRate,\n      levelsCompleted: Math.max(0, progress.unlockedLevels.length - 2),\n      averageAttemptsPerLevel: this.calculateAverageAttempts(levelHistory),\n      plateauDetected: plateauInfo.detected,\n      plateauDuration: plateauInfo.duration,\n      recommendedNextLevel: this.recommendNextLevel(sessions, progress),\n    };\n  }\n\n  private getLevelHistory(sessions: SessionResult[]): Map<string, number> {\n    const history = new Map<string, number>();\n    for (const session of sessions) {\n      const count = history.get(session.levelId) ?? 0;\n      history.set(session.levelId, count + 1);\n    }\n    return history;\n  }\n\n  private calculateProgressionRate(\n    sessions: SessionResult[],\n    progress: UserProgress\n  ): 'fast' | 'normal' | 'slow' {\n    if (sessions.length < 5) return 'normal';\n\n    const sessionsPerLevel = sessions.length / Math.max(1, progress.unlockedLevels.length);\n\n    if (sessionsPerLevel < 3) return 'fast';\n    if (sessionsPerLevel > 8) return 'slow';\n    return 'normal';\n  }\n\n  private calculateAverageAttempts(levelHistory: Map<string, number>): number {\n    if (levelHistory.size === 0) return 0;\n    const attempts = Array.from(levelHistory.values());\n    return this.average(attempts);\n  }\n\n  private detectPlateau(sessions: SessionResult[]): { detected: boolean; duration: number | null } {\n    if (sessions.length < 10) return { detected: false, duration: null };\n\n    const recentAccuracies = sessions.slice(-10).map((s) => s.combinedAccuracy);\n    const variance = this.calculateVariance(recentAccuracies);\n    const average = this.average(recentAccuracies);\n\n    if (variance < 5 && average < 80) {\n      const firstSession = sessions[sessions.length - 10];\n      const lastSession = sessions[sessions.length - 1];\n      if (firstSession && lastSession) {\n        const duration = Math.floor(\n          (lastSession.timestamp.getTime() - firstSession.timestamp.getTime()) /\n            (24 * 60 * 60 * 1000)\n        );\n        return { detected: true, duration };\n      }\n    }\n\n    return { detected: false, duration: null };\n  }\n\n  private recommendNextLevel(sessions: SessionResult[], progress: UserProgress): string | null {\n    if (sessions.length === 0) return null;\n\n    const recentSessions = sessions.slice(-5);\n    const avgAccuracy = this.average(recentSessions.map((s) => s.combinedAccuracy));\n\n    if (avgAccuracy >= 80) {\n      const currentLevel = progress.currentLevel;\n      const nBack = this.extractNBackLevel(currentLevel);\n\n      if (currentLevel.includes('position')) {\n        return `position-${nBack + 1}`;\n      } else if (currentLevel.includes('audio')) {\n        return `audio-${nBack + 1}`;\n      } else if (currentLevel.includes('dual')) {\n        return `dual-${nBack + 1}`;\n      }\n    }\n\n    return null;\n  }\n\n  // ============================================================================\n  // Engagement Analysis\n  // ============================================================================\n\n  private analyzeEngagement(sessions: SessionResult[], progress: UserProgress) {\n    const now = new Date();\n    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n    const sessionsThisWeek = sessions.filter((s) => s.timestamp > weekAgo).length;\n\n    const sessionDurations = sessions.map((s) => s.duration);\n    const sessionHours = sessions.map((s) => s.timestamp.getHours());\n\n    return {\n      totalSessions: sessions.length,\n      sessionsThisWeek,\n      averageSessionsPerWeek: this.calculateWeeklyAverage(sessions),\n      preferredTimeOfDay: this.detectPreferredTime(sessionHours),\n      averageSessionDuration: this.average(sessionDurations),\n      currentStreak: progress.currentStreak,\n      longestStreak: progress.longestStreak,\n      lastSessionDate: progress.lastSessionDate,\n      daysSinceLastSession: progress.lastSessionDate\n        ? Math.floor((now.getTime() - progress.lastSessionDate.getTime()) / (24 * 60 * 60 * 1000))\n        : null,\n    };\n  }\n\n  private calculateWeeklyAverage(sessions: SessionResult[]): number {\n    if (sessions.length === 0) return 0;\n\n    const firstSession = sessions[0];\n    const lastSession = sessions[sessions.length - 1];\n\n    if (!firstSession || !lastSession) return 0;\n\n    const weeks = Math.max(\n      1,\n      (lastSession.timestamp.getTime() - firstSession.timestamp.getTime()) /\n        (7 * 24 * 60 * 60 * 1000)\n    );\n\n    return sessions.length / weeks;\n  }\n\n  private detectPreferredTime(hours: number[]): 'morning' | 'afternoon' | 'evening' | 'night' | null {\n    if (hours.length === 0) return null;\n\n    const buckets = { morning: 0, afternoon: 0, evening: 0, night: 0 };\n\n    for (const hour of hours) {\n      if (hour >= 5 && hour < 12) buckets.morning++;\n      else if (hour >= 12 && hour < 17) buckets.afternoon++;\n      else if (hour >= 17 && hour < 21) buckets.evening++;\n      else buckets.night++;\n    }\n\n    const max = Math.max(buckets.morning, buckets.afternoon, buckets.evening, buckets.night);\n\n    if (max === buckets.morning) return 'morning';\n    if (max === buckets.afternoon) return 'afternoon';\n    if (max === buckets.evening) return 'evening';\n    return 'night';\n  }\n\n  // ============================================================================\n  // Help-Seeking Analysis\n  // ============================================================================\n\n  private analyzeHelpSeeking(events: AnalyticsEvent[]) {\n    const helpEvents = events.filter((e) => e.category === 'help');\n    const popoverEvents = helpEvents.filter((e) => e.type === 'HELP_VIEWED');\n\n    return {\n      popoverViewCount: popoverEvents.length,\n      averagePopoverDuration: this.average(\n        popoverEvents.map((e) => {\n          const payload = e.payload as Record<string, unknown>;\n          return typeof payload.duration === 'number' ? payload.duration : 0;\n        })\n      ),\n      tourCompleted: helpEvents.some((e) => e.type === 'TOUR_COMPLETED'),\n      frequentlyViewedHelp: this.findFrequentHelp(popoverEvents),\n      helpViewTrend: this.calculateHelpTrend(popoverEvents),\n    };\n  }\n\n  private findFrequentHelp(events: AnalyticsEvent[]): string[] {\n    const helpIds = new Map<string, number>();\n\n    for (const event of events) {\n      const payload = event.payload as Record<string, unknown>;\n      const helpId = typeof payload.helpId === 'string' ? payload.helpId : '';\n      if (helpId) {\n        helpIds.set(helpId, (helpIds.get(helpId) ?? 0) + 1);\n      }\n    }\n\n    return Array.from(helpIds.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5)\n      .map(([id]) => id);\n  }\n\n  private calculateHelpTrend(events: AnalyticsEvent[]): 'increasing' | 'stable' | 'decreasing' {\n    if (events.length < 5) return 'stable';\n\n    const sorted = [...events].sort(\n      (a, b) => a.timestamp.getTime() - b.timestamp.getTime()\n    );\n\n    const firstHalf = sorted.slice(0, Math.floor(sorted.length / 2));\n    const secondHalf = sorted.slice(Math.floor(sorted.length / 2));\n\n    if (secondHalf.length > firstHalf.length * 1.5) return 'increasing';\n    if (secondHalf.length < firstHalf.length * 0.5) return 'decreasing';\n    return 'stable';\n  }\n\n  // ============================================================================\n  // Insights Generation\n  // ============================================================================\n\n  private generateInsights(\n    sessions: SessionResult[],\n    progress: UserProgress,\n    events: AnalyticsEvent[]\n  ) {\n    const strengths: string[] = [];\n    const improvements: string[] = [];\n    const motivational: string[] = [];\n    const interventions: string[] = [];\n\n    if (sessions.length > 0) {\n      const recentSessions = sessions.slice(-10);\n      const avgAccuracy = this.average(recentSessions.map((s) => s.combinedAccuracy));\n      const positionAvg = this.average(recentSessions.map((s) => s.positionStats.accuracy));\n      const audioAvg = this.average(recentSessions.map((s) => s.audioStats.accuracy));\n\n      if (avgAccuracy >= 80) {\n        strengths.push('Consistently high accuracy');\n      }\n      if (positionAvg > audioAvg + 10) {\n        strengths.push('Strong spatial working memory');\n        improvements.push('Practice audio-only tasks to balance skills');\n      } else if (audioAvg > positionAvg + 10) {\n        strengths.push('Strong auditory working memory');\n        improvements.push('Practice position-only tasks to balance skills');\n      }\n\n      if (progress.currentStreak >= 7) {\n        motivational.push('Amazing consistency! Your streak shows dedication.');\n      }\n\n      if (avgAccuracy < 60) {\n        improvements.push('Consider practicing at a lower n-back level');\n        interventions.push('Offer to reduce difficulty');\n      }\n    }\n\n    if (progress.currentStreak === 0 && progress.totalSessions > 5) {\n      interventions.push('Send reminder to maintain streak');\n    }\n\n    return {\n      strengths,\n      areasForImprovement: improvements,\n      motivationalFactors: motivational,\n      riskOfChurn: this.assessChurnRisk(sessions, progress),\n      suggestedInterventions: interventions,\n    };\n  }\n\n  private assessChurnRisk(\n    sessions: SessionResult[],\n    progress: UserProgress\n  ): 'low' | 'medium' | 'high' {\n    if (progress.lastSessionDate === null) return 'high';\n\n    const daysSinceLastSession = Math.floor(\n      (Date.now() - progress.lastSessionDate.getTime()) / (24 * 60 * 60 * 1000)\n    );\n\n    if (daysSinceLastSession > 14) return 'high';\n    if (daysSinceLastSession > 7) return 'medium';\n\n    const recentSessions = sessions.slice(-5);\n    if (recentSessions.length > 0) {\n      const avgAccuracy = this.average(recentSessions.map((s) => s.combinedAccuracy));\n      if (avgAccuracy < 50) return 'medium';\n    }\n\n    return 'low';\n  }\n\n  // ============================================================================\n  // Helper Methods\n  // ============================================================================\n\n  private average(nums: number[]): number {\n    if (nums.length === 0) return 0;\n    return nums.reduce((a, b) => a + b, 0) / nums.length;\n  }\n\n  private calculateVariance(nums: number[]): number {\n    if (nums.length === 0) return 0;\n    const avg = this.average(nums);\n    const squaredDiffs = nums.map((n) => Math.pow(n - avg, 2));\n    return this.average(squaredDiffs);\n  }\n\n  private calculateTrend(values: number[]): 'improving' | 'stable' | 'declining' {\n    if (values.length < 3) return 'stable';\n\n    const firstHalf = values.slice(0, Math.floor(values.length / 2));\n    const secondHalf = values.slice(Math.floor(values.length / 2));\n\n    const firstAvg = this.average(firstHalf);\n    const secondAvg = this.average(secondHalf);\n\n    const diff = secondAvg - firstAvg;\n\n    if (diff > 5) return 'improving';\n    if (diff < -5) return 'declining';\n    return 'stable';\n  }\n\n  private calculateResponseTimeTrend(values: number[]): 'faster' | 'stable' | 'slower' {\n    const trend = this.calculateTrend(values);\n    if (trend === 'declining') return 'faster';\n    if (trend === 'improving') return 'slower';\n    return 'stable';\n  }\n\n  private extractNBackLevel(levelId: string): 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 {\n    const match = levelId.match(/(\\d+)/);\n    if (match && match[1]) {\n      const num = parseInt(match[1], 10);\n      if (num >= 1 && num <= 9) return num as 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9;\n    }\n    return 1;\n  }\n\n  private determineStrongerModality(\n    positionStrength: number,\n    audioStrength: number\n  ): 'position' | 'audio' | 'balanced' {\n    const diff = positionStrength - audioStrength;\n    if (diff > 0.1) return 'position';\n    if (diff < -0.1) return 'audio';\n    return 'balanced';\n  }\n\n  private checkFalseAlarmTendency(sessions: SessionResult[]): boolean {\n    if (sessions.length === 0) return false;\n    const recentSessions = sessions.slice(-5);\n    const avgFalseAlarmRate = this.average(\n      recentSessions.map(\n        (s) => (s.positionStats.falseAlarmRate + s.audioStats.falseAlarmRate) / 2\n      )\n    );\n    return avgFalseAlarmRate > 0.3;\n  }\n\n  private checkMissTendency(sessions: SessionResult[]): boolean {\n    if (sessions.length === 0) return false;\n    const recentSessions = sessions.slice(-5);\n    const avgMissRate = this.average(\n      recentSessions.map((s) => {\n        const positionMissRate = 1 - s.positionStats.hitRate;\n        const audioMissRate = 1 - s.audioStats.hitRate;\n        return (positionMissRate + audioMissRate) / 2;\n      })\n    );\n    return avgMissRate > 0.3;\n  }\n\n  private checkEarlyPerformance(sessions: SessionResult[]): boolean {\n    let earlyBetter = 0;\n    let lateBetter = 0;\n\n    for (const session of sessions.slice(-5)) {\n      const trials = session.trials;\n      if (trials.length < 10) continue;\n\n      const firstHalf = trials.slice(0, Math.floor(trials.length / 2));\n      const secondHalf = trials.slice(Math.floor(trials.length / 2));\n\n      const firstAcc = this.calculateTrialAccuracy(firstHalf);\n      const secondAcc = this.calculateTrialAccuracy(secondHalf);\n\n      if (firstAcc > secondAcc + 5) earlyBetter++;\n      else if (secondAcc > firstAcc + 5) lateBetter++;\n    }\n\n    return earlyBetter > lateBetter;\n  }\n\n  private checkLatePerformance(sessions: SessionResult[]): boolean {\n    let earlyBetter = 0;\n    let lateBetter = 0;\n\n    for (const session of sessions.slice(-5)) {\n      const trials = session.trials;\n      if (trials.length < 10) continue;\n\n      const firstHalf = trials.slice(0, Math.floor(trials.length / 2));\n      const secondHalf = trials.slice(Math.floor(trials.length / 2));\n\n      const firstAcc = this.calculateTrialAccuracy(firstHalf);\n      const secondAcc = this.calculateTrialAccuracy(secondHalf);\n\n      if (firstAcc > secondAcc + 5) earlyBetter++;\n      else if (secondAcc > firstAcc + 5) lateBetter++;\n    }\n\n    return lateBetter > earlyBetter;\n  }\n}\n\n/**\n * Factory function to create a ProfileAnalyzer instance\n */\nexport function createProfileAnalyzer(): ProfileAnalyzer {\n  return new ProfileAnalyzer();\n}\n"]}